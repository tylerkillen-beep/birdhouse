<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Birdhouse ‚Äî Super Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --black: #0a0a0a; --red: #cc0000; --red-bright: #ff1a1a;
      --gray: #555; --light-gray: #999; --white: #f0f0f0;
      --card: #141414; --border: rgba(204,0,0,0.18); --border-dim: rgba(255,255,255,0.07);
    }
    body { background: var(--black); color: var(--white); font-family: 'DM Sans', sans-serif; min-height: 100vh; }
    body::before { content:''; position:fixed; inset:0; background-image:linear-gradient(rgba(204,0,0,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(204,0,0,0.03) 1px,transparent 1px); background-size:40px 40px; pointer-events:none; z-index:0; }

    /* Layout */
    .layout { display:grid; grid-template-columns:240px 1fr; min-height:100vh; }
    .sidebar { background:#0d0000; border-right:1px solid var(--border); padding:1.75rem 1.25rem; position:sticky; top:0; height:100vh; display:flex; flex-direction:column; overflow-y:auto; }
    .sidebar-logo img { height:40px; filter:drop-shadow(0 0 10px rgba(204,0,0,0.6)); margin-bottom:0.75rem; }
    .admin-badge { background:rgba(204,0,0,0.15); border:1px solid var(--border); border-radius:6px; padding:0.3rem 0.75rem; font-size:0.62rem; text-transform:uppercase; letter-spacing:0.14em; color:var(--red-bright); margin-bottom:2rem; display:inline-block; }
    .nav-section { font-size:0.58rem; text-transform:uppercase; letter-spacing:0.16em; color:var(--gray); margin:1.1rem 0 0.4rem 0.9rem; }
    .nav-item { display:flex; align-items:center; gap:0.7rem; padding:0.7rem 0.9rem; border-radius:7px; color:var(--gray); font-size:0.85rem; cursor:pointer; transition:all 0.2s; margin-bottom:0.2rem; border:1px solid transparent; user-select:none; }
    .nav-item:hover { color:var(--white); background:rgba(255,255,255,0.04); }
    .nav-item.active { background:rgba(204,0,0,0.12); color:var(--red-bright); border-color:rgba(204,0,0,0.25); }
    .signout-btn { background:none; border:1px solid rgba(255,255,255,0.08); border-radius:7px; padding:0.65rem 1rem; color:var(--gray); font-size:0.8rem; cursor:pointer; width:100%; text-align:left; transition:all 0.2s; display:flex; align-items:center; gap:0.5rem; font-family:'DM Sans',sans-serif; margin-top:auto; }
    .signout-btn:hover { color:var(--white); }

    /* Main */
    .main { padding:2.5rem 3rem; position:relative; z-index:1; }
    .page-eyebrow { font-size:0.62rem; letter-spacing:0.22em; text-transform:uppercase; color:var(--red); margin-bottom:0.3rem; }
    .page-title { font-family:'Bebas Neue',sans-serif; font-size:2.5rem; letter-spacing:0.04em; margin-bottom:2rem; }
    .section-title { font-family:'Bebas Neue',sans-serif; font-size:1.35rem; letter-spacing:0.05em; margin-bottom:1rem; }
    .section-panel { display:none; }
    .section-panel.active { display:block; }

    /* Stats */
    .stats-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:1rem; margin-bottom:2rem; }
    .stat-card { background:var(--card); border-radius:12px; padding:1.4rem; border:1px solid var(--border-dim); transition:border-color 0.2s; }
    .stat-card:hover { border-color:var(--border); }
    .stat-label { font-size:0.65rem; text-transform:uppercase; letter-spacing:0.12em; color:var(--light-gray); margin-bottom:0.4rem; }
    .stat-value { font-family:'Bebas Neue',sans-serif; font-size:2.2rem; color:var(--red-bright); text-shadow:0 0 15px rgba(204,0,0,0.3); }
    .stat-sub { font-size:0.72rem; color:var(--gray); margin-top:0.2rem; }

    /* Cards / Tables */
    .card { background:var(--card); border:1px solid var(--border-dim); border-radius:14px; overflow:hidden; margin-bottom:1.5rem; }
    .card-header { display:flex; justify-content:space-between; align-items:center; padding:1.1rem 1.5rem; border-bottom:1px solid var(--border-dim); }
    .card-title { font-size:0.78rem; font-weight:500; color:var(--light-gray); text-transform:uppercase; letter-spacing:0.08em; }
    table { width:100%; border-collapse:collapse; }
    th { text-align:left; font-size:0.62rem; text-transform:uppercase; letter-spacing:0.12em; color:var(--light-gray); padding:0.7rem 1.25rem; border-bottom:1px solid var(--border-dim); font-weight:500; }
    td { padding:0.95rem 1.25rem; border-bottom:1px solid rgba(255,255,255,0.03); font-size:0.86rem; vertical-align:middle; }
    tr:last-child td { border-bottom:none; }
    tr:hover td { background:rgba(255,255,255,0.02); }

    /* Role badge */
    .role-badge { display:inline-block; padding:0.2rem 0.65rem; border-radius:20px; font-size:0.7rem; font-weight:500; }
    .role-student { background:rgba(80,160,255,0.1); color:#66aaff; border:1px solid rgba(80,160,255,0.2); }
    .role-admin { background:rgba(204,0,0,0.12); color:var(--red-bright); border:1px solid var(--border); }
    .role-customer { background:rgba(255,255,255,0.06); color:var(--light-gray); border:1px solid var(--border-dim); }

    /* Summary card */
    .summary-card { background:var(--card); border:1px solid var(--border-dim); border-radius:12px; padding:1.5rem; margin-bottom:0.75rem; transition:border-color 0.2s; }
    .summary-card:hover { border-color:var(--border); }
    .summary-top { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1rem; }
    .summary-name { font-weight:500; font-size:0.95rem; }
    .summary-meta { font-size:0.75rem; color:var(--gray); margin-top:0.2rem; }
    .summary-date { font-size:0.75rem; color:var(--gray); text-align:right; }
    .summary-field { margin-bottom:0.85rem; }
    .summary-field-label { font-size:0.62rem; text-transform:uppercase; letter-spacing:0.12em; color:var(--light-gray); margin-bottom:0.3rem; }
    .summary-field-val { font-size:0.86rem; color:var(--white); line-height:1.6; }
    .summary-grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; margin-top:0.75rem; }

    /* Schedule builder */
    .schedule-wrap { display:grid; grid-template-columns:360px 1fr; gap:2rem; align-items:start; }
    .schedule-form { background:var(--card); border:1px solid var(--border-dim); border-radius:14px; padding:1.75rem; }
    .form-group { margin-bottom:1.1rem; }
    label { display:block; font-size:0.68rem; font-weight:500; letter-spacing:0.1em; text-transform:uppercase; color:var(--gray); margin-bottom:0.4rem; }
    input[type=text], input[type=date], input[type=time], input[type=email], input[type=password], select {
      width:100%; padding:0.82rem 1rem; border:1px solid var(--border-dim); border-radius:8px;
      background:#0d0d0d; font-family:'DM Sans',sans-serif; font-size:0.9rem; color:var(--white); outline:none; transition:border-color 0.2s;
    }
    input:focus, select:focus { border-color:var(--red); box-shadow:0 0 0 3px rgba(204,0,0,0.1); }
    input::placeholder { color:#444; }
    select option { background:#1a1a1a; }
    .form-row { display:grid; grid-template-columns:1fr 1fr; gap:0.85rem; }
    .form-note { font-size:0.73rem; color:var(--gray); margin-top:0.3rem; line-height:1.5; }

    .btn-primary { background:var(--red); color:white; border:none; border-radius:8px; padding:0.85rem 1.75rem; font-family:'DM Sans',sans-serif; font-size:0.88rem; font-weight:500; cursor:pointer; transition:all 0.2s; text-transform:uppercase; letter-spacing:0.06em; }
    .btn-primary:hover { background:var(--red-bright); box-shadow:0 0 20px rgba(204,0,0,0.4); transform:translateY(-1px); }
    .btn-primary:disabled { opacity:0.45; cursor:not-allowed; transform:none; }
    .btn-ghost { background:transparent; color:var(--light-gray); border:1px solid var(--border-dim); border-radius:8px; padding:0.85rem 1.75rem; font-family:'DM Sans',sans-serif; font-size:0.88rem; cursor:pointer; transition:all 0.2s; text-transform:uppercase; letter-spacing:0.06em; }
    .btn-ghost:hover { border-color:var(--border); color:var(--white); }
    .btn-danger { background:rgba(204,0,0,0.12); color:var(--red-bright); border:1px solid rgba(204,0,0,0.2); border-radius:6px; padding:0.35rem 0.7rem; font-size:0.75rem; cursor:pointer; transition:all 0.2s; font-family:'DM Sans',sans-serif; }
    .btn-danger:hover { background:rgba(204,0,0,0.2); }
    .icon-btn { background:none; border:1px solid var(--border-dim); border-radius:6px; padding:0.35rem 0.65rem; color:var(--light-gray); cursor:pointer; font-size:0.8rem; transition:all 0.2s; font-family:'DM Sans',sans-serif; }
    .icon-btn:hover { border-color:var(--border); color:var(--white); }

    .msg { padding:0.82rem 1rem; border-radius:8px; font-size:0.83rem; display:none; margin-top:0.75rem; }
    .msg.success { background:rgba(0,200,80,0.08); border:1px solid rgba(0,200,80,0.2); color:#4caf50; display:block; }
    .msg.error { background:rgba(204,0,0,0.1); border:1px solid var(--border); color:#ff6b6b; display:block; }

    /* Week nav */
    .week-nav { display:flex; align-items:center; gap:1rem; margin-bottom:1.25rem; }
    .week-nav button { background:none; border:1px solid var(--border-dim); border-radius:6px; padding:0.4rem 0.75rem; color:var(--light-gray); cursor:pointer; font-size:0.82rem; transition:all 0.2s; font-family:'DM Sans',sans-serif; }
    .week-nav button:hover { border-color:var(--border); color:var(--white); }
    .week-label { font-size:0.88rem; color:var(--white); font-weight:500; }

    /* Schedule table */
    .sched-table { background:var(--card); border:1px solid var(--border-dim); border-radius:14px; overflow:hidden; }
    .sched-table table th { background:rgba(204,0,0,0.06); }
    .shift-chip { display:inline-flex; align-items:center; gap:0.5rem; background:rgba(204,0,0,0.1); border:1px solid rgba(204,0,0,0.2); border-radius:6px; padding:0.3rem 0.65rem; font-size:0.78rem; color:var(--red-bright); margin:0.2rem; }

    /* Student accounts */
    .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.88); z-index:100; display:none; align-items:center; justify-content:center; }
    .modal-overlay.open { display:flex; }
    .modal { background:#111; border:1px solid var(--border); border-radius:16px; padding:2rem; width:460px; max-width:95vw; }
    .modal-title { font-family:'Bebas Neue',sans-serif; font-size:1.8rem; letter-spacing:0.05em; margin-bottom:1.5rem; }
    .modal .btn-row { display:flex; gap:1rem; margin-top:1.5rem; }

    /* Filters */
    .filter-row { display:flex; gap:0.75rem; margin-bottom:1.25rem; flex-wrap:wrap; }
    .filter-btn { background:transparent; border:1px solid var(--border-dim); border-radius:20px; padding:0.35rem 0.9rem; font-size:0.78rem; color:var(--gray); cursor:pointer; transition:all 0.2s; font-family:'DM Sans',sans-serif; }
    .filter-btn.active { background:rgba(204,0,0,0.12); border-color:var(--border); color:var(--red-bright); }
    .filter-btn:hover { border-color:var(--border); color:var(--white); }

    .empty-state { color:var(--gray); text-align:center; padding:3rem; font-size:0.88rem; }

    @media (max-width:1000px) { .layout{grid-template-columns:1fr} .sidebar{display:none} .main{padding:1.5rem} .schedule-wrap{grid-template-columns:1fr} .stats-grid{grid-template-columns:1fr 1fr} }
  </style>
</head>
<body>
<div class="layout">
  <aside class="sidebar">
    <div style="margin-bottom:0.5rem"><img src="../logo.png" alt="The Birdhouse" style="height:40px;filter:drop-shadow(0 0 10px rgba(204,0,0,0.6))" /></div>
    <div class="admin-badge">‚öô Super Admin</div>
    <div class="nav-section">Overview</div>
    <div class="nav-item active" onclick="showSection('overview',this)">üìä Dashboard</div>
    <div class="nav-section">Orders</div>
    <div class="nav-item" onclick="showSection('orders',this)">üßæ All Orders & Revenue</div>
    <div class="nav-section">Team</div>
    <div class="nav-item" onclick="showSection('schedule',this)">üóìÔ∏è Schedule Builder</div>
    <div class="nav-item" onclick="showSection('summaries',this)">üìù Weekly Summaries</div>
    <div class="nav-item" onclick="showSection('students',this)">üë• Student Accounts</div>
    <div class="nav-section">Menu</div>
    <div class="nav-item" onclick="showSection('submissions',this)">üì¨ Pending Submissions <span id="admin-sub-badge" style="display:none;background:var(--red);color:white;font-size:0.6rem;padding:0.1rem 0.45rem;border-radius:10px;margin-left:auto"></span></div>
    <div class="nav-item" onclick="showSection('menu',this)">‚òï Menu Manager</div>
    <button class="signout-btn" onclick="signOut()">‚Üê Sign Out</button>
  </aside>

  <main class="main">

    <!-- ‚îÄ‚îÄ OVERVIEW ‚îÄ‚îÄ -->
    <div class="section-panel active" id="section-overview">
      <div class="page-eyebrow">Super Admin</div>
      <h1 class="page-title">Dashboard</h1>
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-label">Student Staff</div><div class="stat-value" id="ov-students">‚Äî</div><div class="stat-sub">Active accounts</div></div>
        <div class="stat-card"><div class="stat-label">Summaries This Week</div><div class="stat-value" id="ov-summaries">‚Äî</div><div class="stat-sub">Submitted</div></div>
        <div class="stat-card"><div class="stat-label">Shifts This Week</div><div class="stat-value" id="ov-shifts">‚Äî</div><div class="stat-sub">Scheduled</div></div>
      </div>
      <div class="section-title">Recent Summaries</div>
      <div id="ov-recent-summaries"><div class="empty-state">Loading...</div></div>
    </div>

    <!-- ‚îÄ‚îÄ ORDERS & REVENUE ‚îÄ‚îÄ -->
    <div class="section-panel" id="section-orders">
      <div class="page-eyebrow">Orders</div>
      <h1 class="page-title">All Orders & Revenue</h1>

      <!-- Revenue summary -->
      <div class="stats-grid" id="orders-stats" style="margin-bottom:2rem">
        <div class="stat-card"><div class="stat-label">Total Orders</div><div class="stat-value" id="rev-total">‚Äî</div></div>
        <div class="stat-card"><div class="stat-label">Delivered</div><div class="stat-value" id="rev-delivered">‚Äî</div></div>
        <div class="stat-card"><div class="stat-label">Active Now</div><div class="stat-value" id="rev-active">‚Äî</div></div>
      </div>

      <!-- Filters -->
      <div class="filter-row" style="margin-bottom:1.25rem">
        <button class="filter-btn active" onclick="adminFilterOrders('all',this)">All</button>
        <button class="filter-btn" onclick="adminFilterOrders('paid',this)">üí≥ Paid</button>
        <button class="filter-btn" onclick="adminFilterOrders('pending',this)">‚è≥ Pending</button>
        <button class="filter-btn" onclick="adminFilterOrders('delivered',this)">‚úÖ Delivered</button>
        <button class="filter-btn" onclick="adminFilterOrders('cancelled',this)">Cancelled</button>
      </div>

      <div class="card">
        <table>
          <thead>
            <tr>
              <th>Customer</th>
              <th>Drink</th>
              <th>Details</th>
              <th>Delivery</th>
              <th>Status</th>
              <th>Date</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="admin-orders-tbody">
            <tr><td colspan="7" class="empty-state">Loading...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ SCHEDULE BUILDER ‚îÄ‚îÄ -->
    <div class="section-panel" id="section-schedule">
      <div class="page-eyebrow">Team</div>
      <h1 class="page-title">Schedule Builder</h1>
      <div class="schedule-wrap">

        <!-- Add shift form -->
        <div class="schedule-form">
          <div class="section-title" style="font-size:1.1rem;margin-bottom:1.25rem">Add a Shift</div>
          <div class="form-group">
            <label>Student</label>
            <select id="sched-student">
              <option value="">Select a student...</option>
            </select>
          </div>
          <div class="form-group">
            <label>Date</label>
            <input type="date" id="sched-date" />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Start Time</label>
              <input type="time" id="sched-start" />
            </div>
            <div class="form-group">
              <label>End Time</label>
              <input type="time" id="sched-end" />
            </div>
          </div>
          <div class="form-group">
            <label>Notes <span style="color:var(--gray);font-weight:300">(optional)</span></label>
            <input type="text" id="sched-notes" placeholder="e.g. Opening shift, bring supplies" />
          </div>
          <button class="btn-primary" onclick="addShift()">Add Shift</button>
          <div class="msg" id="sched-msg"></div>
        </div>

        <!-- Week view -->
        <div>
          <div class="week-nav">
            <button onclick="changeWeek(-1)">‚Üê Prev</button>
            <span class="week-label" id="week-label">This Week</span>
            <button onclick="changeWeek(1)">Next ‚Üí</button>
          </div>
          <div class="sched-table">
            <table>
              <thead>
                <tr>
                  <th>Student</th>
                  <th>Date</th>
                  <th>Time</th>
                  <th>Notes</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="sched-table-body">
                <tr><td colspan="5" class="empty-state">Loading schedule...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ WEEKLY SUMMARIES ‚îÄ‚îÄ -->
    <div class="section-panel" id="section-summaries">
      <div class="page-eyebrow">Team</div>
      <h1 class="page-title">Weekly Summaries</h1>

      <div class="filter-row">
        <button class="filter-btn active" onclick="filterSummaries('all',this)">All</button>
        <button class="filter-btn" onclick="filterSummaries('week',this)">This Week</button>
        <button class="filter-btn" onclick="filterSummaries('last',this)">Last Week</button>
      </div>

      <div id="summaries-container"><div class="empty-state">Loading...</div></div>
    </div>

    <!-- ‚îÄ‚îÄ STUDENT ACCOUNTS ‚îÄ‚îÄ -->
    <div class="section-panel" id="section-students">
      <div class="page-eyebrow">Team</div>
      <h1 class="page-title">Student Accounts</h1>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.25rem">
        <p style="color:var(--gray);font-size:0.88rem">Manage student staff accounts. New students must be created here ‚Äî they cannot self-register.</p>
        <button class="btn-primary" onclick="openNewStudentModal()">+ Add Student</button>
      </div>
      <div class="card">
        <table>
          <thead><tr><th>Name</th><th>Email</th><th>Role</th><th>Actions</th></tr></thead>
          <tbody id="students-table-body">
            <tr><td colspan="4" class="empty-state">Loading...</td></tr>
          </tbody>
        </table>
      </div>
      <p style="color:var(--gray);font-size:0.78rem;margin-top:0.75rem">* Student accounts are managed in Supabase Auth. Role changes take effect on next login.</p>
    </div>

    <!-- ‚îÄ‚îÄ MENU SUBMISSIONS ‚îÄ‚îÄ -->
    <div class="section-panel" id="section-submissions">
      <div class="page-eyebrow">Menu</div>
      <h1 class="page-title">Pending Submissions</h1>
      <div class="filter-row">
        <button class="filter-btn active" onclick="filterSubmissions('pending',this)">‚è≥ Pending</button>
        <button class="filter-btn" onclick="filterSubmissions('approved',this)">‚úÖ Approved</button>
        <button class="filter-btn" onclick="filterSubmissions('rejected',this)">‚úï Rejected</button>
        <button class="filter-btn" onclick="filterSubmissions('all',this)">All</button>
      </div>
      <div id="submissions-container"><div class="empty-state">Loading...</div></div>
    </div>

    <!-- ‚îÄ‚îÄ MENU MANAGER ‚îÄ‚îÄ -->
    <div class="section-panel" id="section-menu">
      <div class="page-eyebrow">Menu</div>
      <h1 class="page-title">Menu Manager</h1>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
        <p style="color:var(--gray);font-size:0.88rem">Add or edit items. Students can toggle availability from their Team Hub.</p>
        <button class="btn-primary" onclick="openItemModal()">+ Add Item</button>
      </div>
      <div class="card">
        <table>
          <thead><tr><th>Item</th><th>Category</th><th>Hot Link</th><th>Iced Link</th><th>Available</th><th></th></tr></thead>
          <tbody id="menu-tbody"><tr><td colspan="6" class="empty-state">Loading...</td></tr></tbody>
        </table>
      </div>
    </div>

  </main>
</div>

<!-- ‚îÄ‚îÄ Add Student Modal ‚îÄ‚îÄ -->
<div class="modal-overlay" id="student-modal">
  <div class="modal">
    <div class="modal-title" id="student-modal-title">Add Student Account</div>
    <div class="form-group"><label>First Name</label><input type="text" id="s-first" placeholder="First" /></div>
    <div class="form-group"><label>Last Name</label><input type="text" id="s-last" placeholder="Last" /></div>
    <div class="form-group"><label>Email</label><input type="email" id="s-email" placeholder="student@example.com" /></div>
    <div class="form-group">
      <label>Temporary Password</label>
      <input type="text" id="s-password" placeholder="They can change this after logging in" />
      <div class="form-note">Share this with the student so they can sign in for the first time.</div>
    </div>
    <div class="form-group">
      <label>Role</label>
      <select id="s-role">
        <option value="student">Student Staff</option>
        <option value="admin">Admin</option>
      </select>
    </div>
    <div class="msg" id="student-msg"></div>
    <div class="btn-row">
      <button class="btn-ghost" onclick="closeStudentModal()">Cancel</button>
      <button class="btn-primary" onclick="createStudent()">Create Account</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ Add/Edit Menu Item Modal ‚îÄ‚îÄ -->
<div class="modal-overlay" id="item-modal">
  <div class="modal" style="width:520px">
    <div class="modal-title" id="item-modal-title">Add Menu Item</div>
    <div class="form-row">
      <div class="form-group"><label>Name</label><input type="text" id="i-name" placeholder="e.g. Vanilla Latte" /></div>
      <div class="form-group"><label>Category</label>
        <select id="i-category"><option>Coffee</option><option>Non-Coffee</option><option>Iced</option><option>Seasonal</option></select>
      </div>
    </div>
    <div class="form-group"><label>Description</label><input type="text" id="i-desc" placeholder="Short description" /></div>
    <div style="background:rgba(255,255,255,0.03);border:1px solid var(--border-dim);border-radius:10px;padding:1.25rem;margin-bottom:1rem">
      <div style="font-size:0.65rem;text-transform:uppercase;letter-spacing:0.12em;color:var(--light-gray);margin-bottom:1rem">Square Payment Links</div>
      <div style="display:flex;gap:0.75rem;margin-bottom:0.75rem;align-items:center">
        <label style="display:flex;align-items:center;gap:0.5rem;cursor:pointer;text-transform:none;letter-spacing:0;font-size:0.85rem;color:var(--white);width:80px;flex-shrink:0">
          <input type="checkbox" id="i-is-hot" checked style="width:auto;padding:0;accent-color:var(--red)" /> ‚òï Hot
        </label>
        <input type="url" id="i-link-hot" placeholder="https://square.link/... (12oz)" />
      </div>
      <div style="display:flex;gap:0.75rem;align-items:center">
        <label style="display:flex;align-items:center;gap:0.5rem;cursor:pointer;text-transform:none;letter-spacing:0;font-size:0.85rem;color:var(--white);width:80px;flex-shrink:0">
          <input type="checkbox" id="i-is-iced" style="width:auto;padding:0;accent-color:#4488ff" /> üßä Iced
        </label>
        <input type="url" id="i-link-iced" placeholder="https://square.link/... (16oz)" />
      </div>
    </div>
    <div class="form-group"><label>Milk Options (comma-separated)</label><input type="text" id="i-milks" value="Whole Milk, Oat Milk, Almond Milk, 2% Milk" /></div>
    <div class="form-group"><label>Syrup Options (comma-separated)</label><input type="text" id="i-syrups" value="Vanilla, Caramel, Hazelnut, Sugar Free Vanilla" /></div>
    <div class="form-row">
      <div class="form-group"><label>Sort Order</label><input type="text" id="i-sort" value="0" /></div>
      <div class="form-group" style="display:flex;align-items:flex-end;padding-bottom:0.1rem">
        <label style="display:flex;align-items:center;gap:0.5rem;cursor:pointer">
          <input type="checkbox" id="i-available" checked style="width:auto;padding:0;accent-color:var(--red)" /> Available now
        </label>
      </div>
    </div>
    <div class="msg" id="item-msg"></div>
    <div class="btn-row">
      <button class="btn-ghost" onclick="closeItemModal()">Cancel</button>
      <button class="btn-primary" onclick="saveItem()">Save Item</button>
    </div>
  </div>
</div>

<script>
  const sb = supabase.createClient('https://ljukrhneikqbabcmcpet.supabase.co','sb_publishable_lWdxpZUHbQHiz04wthAC2g_X4ToxDCn');
  let allSummaries = [], allStudents = [], weekOffset = 0, editingItemId = null;

  // ‚îÄ‚îÄ Auth guard ‚îÄ‚îÄ
  async function init() {
    const {data:{session}} = await sb.auth.getSession();
    if(!session) { window.location.href = 'login.html'; return; }
    if(session.user.user_metadata?.role !== 'admin') {
      await sb.auth.signOut(); window.location.href = 'login.html'; return;
    }
    loadOverview();
    loadStudentDropdown();
    loadSchedule();
    // Load pending submissions badge
    sb.from('menu_submissions').select('*',{count:'exact',head:true}).eq('status','pending').then(({count})=>{
      const badge = document.getElementById('admin-sub-badge');
      if(count>0){badge.textContent=count;badge.style.display='inline';}
    });
  }

  // ‚îÄ‚îÄ Menu Submissions ‚îÄ‚îÄ
  let allSubmissions = [];

  async function loadSubmissions() {
    const {data} = await sb.from('menu_submissions').select('*').order('created_at',{ascending:false});
    allSubmissions = data||[];
    updateAdminSubBadge();
    renderSubmissions('pending');
  }

  function updateAdminSubBadge() {
    const count = allSubmissions.filter(s=>s.status==='pending').length;
    const badge = document.getElementById('admin-sub-badge');
    if(count>0){badge.textContent=count;badge.style.display='inline';}
    else{badge.style.display='none';}
  }

  function filterSubmissions(status, btn) {
    document.querySelectorAll('#section-submissions .filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    renderSubmissions(status);
  }

  function renderSubmissions(filter) {
    const list = filter==='all' ? allSubmissions : allSubmissions.filter(s=>s.status===filter);
    const container = document.getElementById('submissions-container');
    if(!list.length){container.innerHTML=`<div class="empty-state">No ${filter==='all'?'':filter} submissions.</div>`;return;}
    const typeLabel = {new:'New Item', edit:'Edit Suggestion'};
    const statusColor = {pending:'#ff9800',approved:'#4caf50',rejected:'#666'};
    container.innerHTML = list.map(s=>`
      <div class="summary-card" style="border-left:3px solid ${statusColor[s.status]}">
        <div class="summary-top">
          <div>
            <div class="summary-name">${s.proposed_name} <span style="font-size:0.72rem;color:var(--gray);font-weight:400">${typeLabel[s.type]||s.type}</span></div>
            <div class="summary-meta">By ${s.student_name} ¬∑ ${new Date(s.created_at).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})}</div>
          </div>
          <div style="font-size:0.78rem;font-weight:500;color:${statusColor[s.status]}">${s.status.charAt(0).toUpperCase()+s.status.slice(1)}</div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem">
          <div><div class="summary-field-label">Description</div><div class="summary-field-val">${s.proposed_description||'‚Äî'}</div></div>
          <div><div class="summary-field-label">Category & Type</div><div class="summary-field-val">${s.proposed_category||'‚Äî'} ${s.proposed_is_hot?'‚òï':''}${s.proposed_is_iced?'üßä':''}</div></div>
          ${s.notes?`<div style="grid-column:1/-1"><div class="summary-field-label">Student Notes</div><div class="summary-field-val">${s.notes}</div></div>`:''}
        </div>
        ${s.status==='pending'?`
          <div style="display:flex;gap:0.75rem;align-items:center;flex-wrap:wrap">
            <button class="btn-primary" style="padding:0.55rem 1.25rem;font-size:0.82rem" onclick="approveSubmission('${s.id}')">‚úì Approve & Add to Menu</button>
            <button class="btn-ghost" style="padding:0.55rem 1.25rem;font-size:0.82rem" onclick="rejectSubmission('${s.id}')">‚úï Reject</button>
          </div>` : s.admin_note ? `<div style="font-size:0.82rem;color:var(--light-gray);padding:0.6rem 0.85rem;background:rgba(255,255,255,0.03);border-radius:6px">Admin note: ${s.admin_note}</div>` : ''}
      </div>`).join('');
  }

  async function approveSubmission(id) {
    const sub = allSubmissions.find(s=>s.id===id);
    if(!sub) return;
    // Add or update menu item
    const payload = {
      name: sub.proposed_name,
      description: sub.proposed_description,
      category: sub.proposed_category,
      is_hot: sub.proposed_is_hot,
      is_iced: sub.proposed_is_iced,
      available: true
    };
    if(sub.type==='edit' && sub.target_item_id) {
      await sb.from('menu_items').update(payload).eq('id', sub.target_item_id);
    } else {
      await sb.from('menu_items').insert({...payload, sort_order:0});
    }
    await sb.from('menu_submissions').update({status:'approved', reviewed_at: new Date().toISOString()}).eq('id',id);
    sub.status='approved';
    updateAdminSubBadge();
    renderSubmissions(document.querySelector('#section-submissions .filter-btn.active')?.dataset.filter||'pending');
    loadMenu();
  }

  async function rejectSubmission(id) {
    const note = prompt('Optional: Leave a note for the student explaining why (or leave blank):');
    if(note===null) return; // cancelled
    await sb.from('menu_submissions').update({status:'rejected', admin_note: note||null, reviewed_at: new Date().toISOString()}).eq('id',id);
    const sub = allSubmissions.find(s=>s.id===id);
    if(sub){sub.status='rejected';sub.admin_note=note;}
    updateAdminSubBadge();
    renderSubmissions(document.querySelector('#section-submissions .filter-btn.active')?.dataset.filter||'pending');
  }

  // ‚îÄ‚îÄ Admin Orders ‚îÄ‚îÄ
  let adminAllOrders = [];

  async function loadAdminOrders() {
    const {data} = await sb.from('orders').select('*').order('created_at',{ascending:false});
    adminAllOrders = data||[];
    // Stats
    const total     = adminAllOrders.length;
    const delivered = adminAllOrders.filter(o=>o.status==='delivered').length;
    const active    = adminAllOrders.filter(o=>o.status==='pending'||o.status==='paid').length;
    document.getElementById('rev-total').textContent     = total;
    document.getElementById('rev-delivered').textContent = delivered;
    document.getElementById('rev-active').textContent    = active;
    adminRenderOrders('all');
  }

  function adminFilterOrders(filter, btn) {
    document.querySelectorAll('#section-orders .filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    adminRenderOrders(filter);
  }

  function adminRenderOrders(filter) {
    let list = adminAllOrders;
    if(filter!=='all') list = adminAllOrders.filter(o=>o.status===filter);
    const tbody = document.getElementById('admin-orders-tbody');
    if(!list.length){tbody.innerHTML=`<tr><td colspan="7" class="empty-state">No ${filter} orders.</td></tr>`;return;}
    const statusColors = {pending:'#ff9800',paid:'var(--red-bright)',delivered:'#4caf50',cancelled:'#666'};
    const statusLabels = {pending:'‚è≥ Pending',paid:'üí≥ Paid',delivered:'‚úÖ Delivered',cancelled:'Cancelled'};
    tbody.innerHTML = list.map(o=>`
      <tr>
        <td><strong>${o.customer_name||'‚Äî'}</strong></td>
        <td>${o.drink_name}</td>
        <td style="font-size:0.8rem;color:var(--gray)">${o.size||''} ${o.milk?'¬∑ '+o.milk:''} ${o.syrup&&o.syrup!=='None'?'¬∑ '+o.syrup:''}</td>
        <td style="font-size:0.8rem;color:var(--gray)">${o.room||'‚Äî'} ¬∑ ${o.delivery_time||'‚Äî'}</td>
        <td><span style="font-size:0.75rem;font-weight:500;color:${statusColors[o.status]||'#999'}">${statusLabels[o.status]||o.status}</span></td>
        <td style="font-size:0.78rem;color:var(--gray)">${new Date(o.created_at).toLocaleDateString('en-US',{month:'short',day:'numeric'})}</td>
        <td style="display:flex;gap:0.4rem;flex-wrap:wrap">
          ${o.status!=='delivered'&&o.status!=='cancelled'?`<button class="icon-btn" style="color:#4caf50;border-color:rgba(0,200,80,0.2)" onclick="adminMarkDelivered('${o.id}')">‚úì Delivered</button>`:''}
          ${o.status!=='cancelled'&&o.status!=='delivered'?`<button class="btn-danger" onclick="adminCancelOrder('${o.id}')">Cancel</button>`:''}
        </td>
      </tr>`).join('');
  }

  async function adminMarkDelivered(id) {
    await sb.from('orders').update({status:'delivered'}).eq('id',id);
    const o = adminAllOrders.find(x=>x.id===id); if(o) o.status='delivered';
    adminRenderOrders(document.querySelector('#section-orders .filter-btn.active')?.textContent.trim().replace(/[^a-z]/gi,'').toLowerCase()||'all');
  }

  async function adminCancelOrder(id) {
    if(!confirm('Cancel this order?')) return;
    await sb.from('orders').update({status:'cancelled'}).eq('id',id);
    const o = adminAllOrders.find(x=>x.id===id); if(o) o.status='cancelled';
    adminRenderOrders(document.querySelector('#section-orders .filter-btn.active')?.textContent.trim().replace(/[^a-z]/gi,'').toLowerCase()||'all');
  }

  // ‚îÄ‚îÄ Overview ‚îÄ‚îÄ
  async function loadOverview() {
    const weekStart = getWeekStart(0);
    const weekEnd   = new Date(weekStart); weekEnd.setDate(weekStart.getDate()+7);
    const [{data:students},{data:summaries},{data:shifts}] = await Promise.all([
      sb.from('schedules').select('student_name').gte('shift_date', weekStart.toISOString().split('T')[0]).lt('shift_date', weekEnd.toISOString().split('T')[0]),
      sb.from('weekly_summaries').select('*').gte('created_at', weekStart.toISOString()).order('created_at',{ascending:false}),
      sb.from('schedules').select('id').gte('shift_date', weekStart.toISOString().split('T')[0]).lt('shift_date', weekEnd.toISOString().split('T')[0])
    ]);
    const uniqueStudents = new Set((students||[]).map(s=>s.student_name));
    document.getElementById('ov-students').textContent = uniqueStudents.size;
    document.getElementById('ov-summaries').textContent = summaries?.length||0;
    document.getElementById('ov-shifts').textContent = shifts?.length||0;

    const container = document.getElementById('ov-recent-summaries');
    if(!summaries?.length){container.innerHTML='<div class="empty-state">No summaries submitted this week yet.</div>';return;}
    container.innerHTML = summaries.slice(0,3).map(s => renderSummaryCard(s)).join('');
  }

  // ‚îÄ‚îÄ Schedule ‚îÄ‚îÄ
  function getWeekStart(offset=0) {
    const d = new Date();
    const day = d.getDay();
    const diff = d.getDate() - (day===0?6:day-1) + (offset*7);
    return new Date(d.setDate(diff));
  }

  function changeWeek(dir) {
    weekOffset += dir;
    loadSchedule();
  }

  async function loadSchedule() {
    const ws = getWeekStart(weekOffset);
    const we = new Date(ws); we.setDate(ws.getDate()+7);
    const label = document.getElementById('week-label');
    label.textContent = `Week of ${ws.toLocaleDateString('en-US',{month:'short',day:'numeric'})} ‚Äì ${new Date(we.getTime()-1).toLocaleDateString('en-US',{month:'short',day:'numeric'})}`;

    const {data} = await sb.from('schedules').select('*')
      .gte('shift_date', ws.toISOString().split('T')[0])
      .lt('shift_date', we.toISOString().split('T')[0])
      .order('shift_date').order('start_time');

    const tbody = document.getElementById('sched-table-body');
    if(!data?.length){tbody.innerHTML='<tr><td colspan="5" class="empty-state">No shifts scheduled for this week.</td></tr>';return;}
    tbody.innerHTML = data.map(s=>`
      <tr>
        <td><strong>${s.student_name}</strong></td>
        <td>${new Date(s.shift_date+'T12:00:00').toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'})}</td>
        <td>${formatTime(s.start_time)} ‚Äì ${formatTime(s.end_time)}</td>
        <td style="color:var(--gray);font-size:0.82rem">${s.notes||'‚Äî'}</td>
        <td><button class="btn-danger" onclick="deleteShift('${s.id}')">Remove</button></td>
      </tr>`).join('');
  }

  function formatTime(t) {
    if(!t) return '‚Äî';
    const [h,m] = t.split(':');
    const hr = parseInt(h); const ampm = hr>=12?'PM':'AM';
    return `${hr>12?hr-12:hr||12}:${m} ${ampm}`;
  }

  async function loadStudentDropdown() {
    // Load from schedules student_name list + known students
    const {data} = await sb.from('schedules').select('student_name').order('student_name');
    const sel = document.getElementById('sched-student');
    // Clear existing options after placeholder
    while(sel.options.length > 1) sel.remove(1);
    const seen = new Set();
    // Also load student accounts if available
    const {data:accounts} = await sb.from('student_accounts_view').select('*').limit(50).catch(()=>({data:null}));
    if(accounts) {
      accounts.forEach(a=>{
        if(!seen.has(a.email)){
          seen.add(a.email);
          const o=document.createElement('option');
          o.value=a.full_name||a.email; o.textContent=(a.full_name||a.email);
          sel.appendChild(o);
        }
      });
    }
    // Fall back to names from schedules
    (data||[]).forEach(r=>{
      if(!seen.has(r.student_name)){
        seen.add(r.student_name);
        const o=document.createElement('option');
        o.value=r.student_name; o.textContent=r.student_name;
        sel.appendChild(o);
      }
    });
    // Add manual entry option
    const manual = document.createElement('option');
    manual.value='__manual__'; manual.textContent='+ Enter name manually...';
    sel.appendChild(manual);
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    document.getElementById('sched-student')?.addEventListener('change', function(){
      if(this.value==='__manual__'){
        const name = prompt('Enter student name:');
        if(name){
          const o=document.createElement('option');
          o.value=name; o.textContent=name; o.selected=true;
          this.insertBefore(o, this.lastElementChild);
        } else { this.value=''; }
      }
    });
  });

  async function addShift() {
    const btn = event.target; btn.disabled=true; btn.textContent='Adding...';
    const student = document.getElementById('sched-student').value;
    const date    = document.getElementById('sched-date').value;
    const start   = document.getElementById('sched-start').value;
    const end     = document.getElementById('sched-end').value;
    const notes   = document.getElementById('sched-notes').value;
    const m = document.getElementById('sched-msg');

    if(!student||student==='__manual__'||!date||!start||!end){
      m.textContent='Please fill in all required fields.'; m.className='msg error';
      btn.disabled=false; btn.textContent='Add Shift'; return;
    }

    const {error} = await sb.from('schedules').insert({
      student_id: '00000000-0000-0000-0000-000000000000',
      student_name: student, shift_date: date,
      start_time: start, end_time: end, notes
    });

    if(error){m.textContent='Error: '+error.message; m.className='msg error';}
    else {
      m.textContent='‚úì Shift added!'; m.className='msg success';
      document.getElementById('sched-date').value='';
      document.getElementById('sched-start').value='';
      document.getElementById('sched-end').value='';
      document.getElementById('sched-notes').value='';
      document.getElementById('sched-student').value='';
      loadSchedule();
    }
    btn.disabled=false; btn.textContent='Add Shift';
  }

  async function deleteShift(id) {
    if(!confirm('Remove this shift?')) return;
    await sb.from('schedules').delete().eq('id',id);
    loadSchedule();
  }

  // ‚îÄ‚îÄ Summaries ‚îÄ‚îÄ
  async function loadSummaries() {
    const {data} = await sb.from('weekly_summaries').select('*').order('created_at',{ascending:false});
    allSummaries = data||[];
    renderSummaries(allSummaries);
  }

  function filterSummaries(period, btn) {
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const now = new Date();
    let filtered = allSummaries;
    if(period==='week'){
      const ws = getWeekStart(0).toISOString();
      filtered = allSummaries.filter(s=>s.created_at>=ws);
    } else if(period==='last'){
      const ws = getWeekStart(-1).toISOString();
      const we = getWeekStart(0).toISOString();
      filtered = allSummaries.filter(s=>s.created_at>=ws && s.created_at<we);
    }
    renderSummaries(filtered);
  }

  function renderSummaries(list) {
    const container = document.getElementById('summaries-container');
    if(!list.length){container.innerHTML='<div class="empty-state">No summaries found.</div>';return;}
    container.innerHTML = list.map(s=>renderSummaryCard(s)).join('');
  }

  function renderSummaryCard(s) {
    return `<div class="summary-card">
      <div class="summary-top">
        <div>
          <div class="summary-name">${s.student_name}</div>
          <div class="summary-meta">Week of ${s.week_of} ¬∑ ${s.hours_worked}h worked ¬∑ ${s.orders_fulfilled} orders ¬∑ ${'‚≠ê'.repeat(s.rating||0)}</div>
        </div>
        <div class="summary-date">${new Date(s.created_at).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})}</div>
      </div>
      <div class="summary-grid">
        ${s.went_well?`<div class="summary-field"><div class="summary-field-label">What Went Well</div><div class="summary-field-val">${s.went_well}</div></div>`:''}
        ${s.improvements?`<div class="summary-field"><div class="summary-field-label">Improvements</div><div class="summary-field-val">${s.improvements}</div></div>`:''}
        ${s.inventory_notes?`<div class="summary-field"><div class="summary-field-label">Inventory Notes</div><div class="summary-field-val">${s.inventory_notes}</div></div>`:''}
        ${s.notes?`<div class="summary-field"><div class="summary-field-label">Additional Notes</div><div class="summary-field-val">${s.notes}</div></div>`:''}
      </div>
    </div>`;
  }

  // ‚îÄ‚îÄ Student Accounts ‚îÄ‚îÄ
  async function loadStudents() {
    // We can only see users via Supabase admin API which requires service role key (not safe client-side)
    // So we store student info in a students table instead
    const {data} = await sb.from('students').select('*').order('created_at',{ascending:false});
    allStudents = data||[];
    const tbody = document.getElementById('students-table-body');
    if(!allStudents.length){tbody.innerHTML='<tr><td colspan="4" class="empty-state">No student accounts yet.</td></tr>';return;}
    tbody.innerHTML = allStudents.map(s=>`
      <tr>
        <td><strong>${s.first_name} ${s.last_name}</strong></td>
        <td style="color:var(--gray)">${s.email}</td>
        <td><span class="role-badge role-${s.role||'student'}">${s.role||'student'}</span></td>
        <td style="display:flex;gap:0.5rem">
          <button class="icon-btn" onclick="resetPasswordPrompt('${s.email}')">Reset PW</button>
          <button class="btn-danger" onclick="removeStudent('${s.id}','${s.first_name}')">Remove</button>
        </td>
      </tr>`).join('');
  }

  function openNewStudentModal() {
    ['s-first','s-last','s-email','s-password'].forEach(id=>document.getElementById(id).value='');
    document.getElementById('s-role').value='student';
    document.getElementById('student-msg').style.display='none';
    document.getElementById('student-modal').classList.add('open');
  }
  function closeStudentModal() { document.getElementById('student-modal').classList.remove('open'); }

  async function createStudent() {
    const first    = document.getElementById('s-first').value.trim();
    const last     = document.getElementById('s-last').value.trim();
    const email    = document.getElementById('s-email').value.trim();
    const password = document.getElementById('s-password').value.trim();
    const role     = document.getElementById('s-role').value;
    const m = document.getElementById('student-msg');

    if(!first||!last||!email||!password){m.textContent='All fields are required.';m.className='msg error';return;}

    // Create auth user via Supabase signUp (will send confirmation email)
    const {data, error} = await sb.auth.signUp({
      email, password,
      options: { data: { first_name:first, last_name:last, role } }
    });

    if(error){m.textContent='Error: '+error.message; m.className='msg error'; return;}

    // Also save to students table for easy listing
    await sb.from('students').insert({
      id: data.user?.id,
      first_name:first, last_name:last, email, role
    });

    m.textContent=`‚úì Account created for ${first}! They'll get a confirmation email at ${email}.`;
    m.className='msg success';
    loadStudents();
    loadStudentDropdown();
  }

  async function removeStudent(id, name) {
    if(!confirm(`Remove ${name}'s account from the roster? (This removes them from your list but does not delete their Supabase auth account.)`)) return;
    await sb.from('students').delete().eq('id',id);
    loadStudents();
  }

  function resetPasswordPrompt(email) {
    if(!confirm(`Send a password reset email to ${email}?`)) return;
    sb.auth.resetPasswordForEmail(email).then(({error})=>{
      alert(error ? 'Error: '+error.message : `Reset email sent to ${email}!`);
    });
  }

  // ‚îÄ‚îÄ Menu Manager ‚îÄ‚îÄ
  async function loadMenu() {
    const {data} = await sb.from('menu_items').select('*').order('sort_order');
    const tbody = document.getElementById('menu-tbody');
    if(!data?.length){tbody.innerHTML='<tr><td colspan="6" class="empty-state">No menu items yet.</td></tr>';return;}
    tbody.innerHTML = data.map(item=>`
      <tr>
        <td><strong>${item.name}</strong><div style="font-size:0.75rem;color:var(--gray)">${item.description||''}</div></td>
        <td style="color:var(--gray)">${item.category}</td>
        <td>${item.square_link_hot?`<a href="${item.square_link_hot}" target="_blank" style="color:var(--red-bright);font-size:0.8rem;text-decoration:none">Link ‚Üó</a>`:'<span style="color:var(--gray);font-size:0.8rem">‚Äî</span>'}</td>
        <td>${item.square_link_iced?`<a href="${item.square_link_iced}" target="_blank" style="color:#66aaff;font-size:0.8rem;text-decoration:none">Link ‚Üó</a>`:'<span style="color:var(--gray);font-size:0.8rem">‚Äî</span>'}</td>
        <td><span style="font-size:0.78rem;color:${item.available?'#4caf50':'var(--gray)'}">${item.available?'‚úì On':'‚úï Off'}</span></td>
        <td style="display:flex;gap:0.5rem">
          <button class="icon-btn" onclick='openItemModal(${JSON.stringify(item).replace(/'/g,"&#39;")})'>Edit</button>
          <button class="btn-danger" onclick="deleteItem('${item.id}')">Delete</button>
        </td>
      </tr>`).join('');
  }

  function openItemModal(item=null) {
    editingItemId = item?.id||null;
    document.getElementById('item-modal-title').textContent = item ? 'Edit Item' : 'Add Menu Item';
    document.getElementById('i-name').value   = item?.name||'';
    document.getElementById('i-desc').value   = item?.description||'';
    document.getElementById('i-link-hot').value  = item?.square_link_hot||'';
    document.getElementById('i-link-iced').value = item?.square_link_iced||'';
    document.getElementById('i-is-hot').checked  = item ? item.is_hot!==false : true;
    document.getElementById('i-is-iced').checked = item?.is_iced===true||false;
    document.getElementById('i-milks').value  = (item?.available_milks||['Whole Milk','Oat Milk','Almond Milk','2% Milk']).join(', ');
    document.getElementById('i-syrups').value = (item?.available_syrups||['Vanilla','Caramel','Hazelnut','Sugar Free Vanilla']).join(', ');
    document.getElementById('i-sort').value   = item?.sort_order||0;
    document.getElementById('i-available').checked = item?.available!==false;
    document.getElementById('i-category').value = item?.category||'Coffee';
    document.getElementById('item-msg').style.display='none';
    document.getElementById('item-modal').classList.add('open');
  }
  function closeItemModal() { document.getElementById('item-modal').classList.remove('open'); }

  async function saveItem() {
    const name = document.getElementById('i-name').value.trim();
    const m = document.getElementById('item-msg');
    if(!name){m.textContent='Name is required.';m.className='msg error';return;}
    const payload = {
      name, category:document.getElementById('i-category').value,
      description:document.getElementById('i-desc').value,
      is_hot:document.getElementById('i-is-hot').checked,
      is_iced:document.getElementById('i-is-iced').checked,
      square_link_hot:document.getElementById('i-link-hot').value||null,
      square_link_iced:document.getElementById('i-link-iced').value||null,
      available_milks:document.getElementById('i-milks').value.split(',').map(s=>s.trim()).filter(Boolean),
      available_syrups:document.getElementById('i-syrups').value.split(',').map(s=>s.trim()).filter(Boolean),
      sort_order:parseInt(document.getElementById('i-sort').value)||0,
      available:document.getElementById('i-available').checked
    };
    const {error} = editingItemId
      ? await sb.from('menu_items').update(payload).eq('id',editingItemId)
      : await sb.from('menu_items').insert(payload);
    if(error){m.textContent='Error: '+error.message;m.className='msg error';}
    else{m.textContent='‚úì Saved!';m.className='msg success';setTimeout(()=>{closeItemModal();loadMenu();},700);}
  }

  async function deleteItem(id) {
    if(!confirm('Delete this menu item?')) return;
    await sb.from('menu_items').delete().eq('id',id);
    loadMenu();
  }

  // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
  function showSection(name, el) {
    document.querySelectorAll('.section-panel').forEach(p=>p.classList.remove('active'));
    document.getElementById('section-'+name).classList.add('active');
    document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
    el.classList.add('active');
    if(name==='summaries') loadSummaries();
    if(name==='students')  loadStudents();
    if(name==='menu')      loadMenu();
    if(name==='schedule')  loadSchedule();
    if(name==='orders')    loadAdminOrders();
    if(name==='submissions') loadSubmissions();
  }

  async function signOut() { await sb.auth.signOut(); window.location.href='login.html'; }

  document.querySelectorAll('.modal-overlay').forEach(m=>{
    m.addEventListener('click', e=>{ if(e.target===m) m.classList.remove('open'); });
  });

  init();
</script>
</body>
</html>
