<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Birdhouse ‚Äî Team Hub</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --black: #0a0a0a; --dark: #111; --red: #cc0000; --red-bright: #ff1a1a;
      --gray: #555; --light-gray: #999; --white: #f0f0f0;
      --card: #141414; --border: rgba(204,0,0,0.18); --border-dim: rgba(255,255,255,0.07);
    }
    body { background: var(--black); color: var(--white); font-family: 'DM Sans', sans-serif; min-height: 100vh; }
    .layout { display: grid; grid-template-columns: 220px 1fr; min-height: 100vh; }

    .sidebar { background: #0d0000; border-right: 1px solid var(--border); padding: 1.75rem 1.25rem; position: sticky; top: 0; height: 100vh; display: flex; flex-direction: column; }
    .sidebar-logo img { height: 38px; filter: drop-shadow(0 0 8px rgba(204,0,0,0.5)); margin-bottom: 2rem; }
    .user-card { background: rgba(204,0,0,0.08); border: 1px solid var(--border); border-radius: 10px; padding: 1rem; margin-bottom: 1.75rem; }
    .user-name { font-size: 0.9rem; color: var(--white); font-weight: 500; }
    .user-role { font-size: 0.68rem; color: var(--red-bright); margin-top: 0.25rem; letter-spacing: 0.08em; text-transform: uppercase; }
    nav { flex: 1; }
    .nav-item { display: flex; align-items: center; gap: 0.7rem; padding: 0.7rem 0.9rem; border-radius: 7px; color: var(--gray); font-size: 0.85rem; text-decoration: none; cursor: pointer; transition: all 0.2s; margin-bottom: 0.2rem; border: 1px solid transparent; }
    .nav-item:hover { color: var(--white); background: rgba(255,255,255,0.04); }
    .nav-item.active { background: rgba(204,0,0,0.12); color: var(--red-bright); border-color: rgba(204,0,0,0.25); }
    .signout-btn { background: none; border: 1px solid rgba(255,255,255,0.08); border-radius: 7px; padding: 0.65rem 1rem; color: var(--gray); font-size: 0.8rem; cursor: pointer; width: 100%; text-align: left; transition: all 0.2s; display: flex; align-items: center; gap: 0.5rem; font-family: 'DM Sans', sans-serif; }
    .signout-btn:hover { color: var(--white); }

    .main { padding: 2.5rem 3rem; }
    .page-eyebrow { font-size: 0.65rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--red); margin-bottom: 0.3rem; }
    .page-title { font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; letter-spacing: 0.04em; margin-bottom: 2rem; }

    .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 2rem; }
    .stat-card { background: var(--card); border-radius: 12px; padding: 1.5rem; border: 1px solid var(--border-dim); transition: border-color 0.2s; }
    .stat-card:hover { border-color: var(--border); }
    .stat-label { font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.12em; color: var(--light-gray); margin-bottom: 0.5rem; }
    .stat-value { font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; color: var(--red-bright); text-shadow: 0 0 15px rgba(204,0,0,0.4); letter-spacing: 0.05em; }
    .stat-sub { font-size: 0.75rem; color: var(--gray); margin-top: 0.25rem; }

    .section { margin-bottom: 2rem; }
    .section-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; letter-spacing: 0.05em; margin-bottom: 1rem; }

    .btn-primary { background: var(--red); color: white; border: none; border-radius: 8px; padding: 0.85rem 1.5rem; font-family: 'DM Sans', sans-serif; font-size: 0.88rem; font-weight: 500; cursor: pointer; transition: background 0.2s, box-shadow 0.2s, transform 0.15s; text-transform: uppercase; letter-spacing: 0.05em; }
    .btn-primary:hover { background: var(--red-bright); box-shadow: 0 0 20px rgba(204,0,0,0.4); transform: translateY(-1px); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .btn-secondary { background: transparent; color: var(--red-bright); border: 1px solid var(--border); border-radius: 8px; padding: 0.85rem 1.5rem; font-family: 'DM Sans', sans-serif; font-size: 0.88rem; cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 0.05em; }
    .btn-secondary:hover { background: rgba(204,0,0,0.1); }

    /* Schedule */
    .schedule-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.75rem; }
    .schedule-day { background: var(--card); border: 1px solid var(--border-dim); border-radius: 10px; padding: 1rem; text-align: center; transition: border-color 0.2s; }
    .schedule-day.today { border-color: var(--red); background: rgba(204,0,0,0.05); }
    .day-name { font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.12em; color: var(--light-gray); margin-bottom: 0.3rem; }
    .day-date { font-size: 0.68rem; color: var(--gray); margin-bottom: 0.5rem; }
    .day-shift { font-size: 0.85rem; font-weight: 500; color: var(--red-bright); }
    .day-time { font-size: 0.72rem; color: var(--gray); margin-top: 0.2rem; }
    .day-off { color: rgba(255,255,255,0.15); font-size: 0.8rem; }

    /* Inventory */
    .table-wrap { background: var(--card); border: 1px solid var(--border-dim); border-radius: 12px; overflow: hidden; }
    table { width: 100%; border-collapse: collapse; }
    th { text-align: left; font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.12em; color: var(--light-gray); padding: 0.75rem 1.25rem; border-bottom: 1px solid var(--border-dim); font-weight: 500; }
    td { padding: 1rem 1.25rem; border-bottom: 1px solid rgba(255,255,255,0.03); font-size: 0.88rem; }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: rgba(255,255,255,0.02); }
    .stock-badge { display: inline-block; padding: 0.2rem 0.7rem; border-radius: 20px; font-size: 0.72rem; font-weight: 500; }
    .stock-ok { background: rgba(0,200,80,0.1); color: #4caf50; border: 1px solid rgba(0,200,80,0.2); }
    .stock-low { background: rgba(204,120,0,0.1); color: #ff9800; border: 1px solid rgba(204,120,0,0.2); }
    .stock-out { background: rgba(204,0,0,0.1); color: var(--red-bright); border: 1px solid var(--border); }
    .qty-input { width: 70px; padding: 0.35rem 0.5rem; border: 1px solid var(--border-dim); border-radius: 6px; font-size: 0.85rem; text-align: center; outline: none; background: var(--black); color: var(--white); }
    .qty-input:focus { border-color: var(--red); }
    .update-btn { background: var(--red); color: white; border: none; border-radius: 6px; padding: 0.35rem 0.75rem; font-size: 0.75rem; cursor: pointer; transition: background 0.2s; text-transform: uppercase; letter-spacing: 0.05em; }
    .update-btn:hover { background: var(--red-bright); }

    /* Sales chart */
    .sales-chart { display: flex; align-items: flex-end; gap: 0.5rem; height: 160px; padding: 1rem 1rem 0; background: var(--card); border: 1px solid var(--border-dim); border-radius: 12px; }
    .bar-wrap { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.4rem; height: 100%; justify-content: flex-end; }
    .bar { width: 100%; background: var(--red); border-radius: 3px 3px 0 0; opacity: 0.7; transition: opacity 0.2s; min-height: 3px; box-shadow: 0 0 10px rgba(204,0,0,0.3); }
    .bar:hover { opacity: 1; }
    .bar-label { font-size: 0.65rem; color: var(--gray); text-align: center; padding-bottom: 0.5rem; }

    /* Summary form */
    .summary-form { background: var(--card); border: 1px solid var(--border-dim); border-radius: 14px; padding: 2rem; }
    .form-group { margin-bottom: 1.15rem; }
    label { display: block; font-size: 0.7rem; font-weight: 500; letter-spacing: 0.1em; text-transform: uppercase; color: var(--gray); margin-bottom: 0.4rem; }
    input[type=text], input[type=date], input[type=number], select, textarea { width: 100%; padding: 0.85rem 1rem; border: 1px solid var(--border-dim); border-radius: 8px; background: #0f0f0f; font-family: 'DM Sans', sans-serif; font-size: 0.9rem; color: var(--white); outline: none; transition: border-color 0.2s; }
    input:focus, select:focus, textarea:focus { border-color: var(--red); }
    select option { background: #1a1a1a; }
    textarea { resize: vertical; min-height: 110px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .msg { margin-top: 1rem; padding: 0.85rem 1rem; border-radius: 8px; font-size: 0.85rem; display: none; }
    .msg.success { background: rgba(0,200,80,0.08); border: 1px solid rgba(0,200,80,0.2); color: #4caf50; display: block; }
    .msg.error { background: rgba(204,0,0,0.1); border: 1px solid var(--border); color: #ff6b6b; display: block; }

    .past-summary-item { background: var(--card); border: 1px solid var(--border-dim); border-radius: 10px; padding: 1.1rem 1.25rem; margin-bottom: 0.6rem; display: flex; justify-content: space-between; align-items: center; }
    .past-summary-item:hover { border-color: var(--border); }

    /* Order status */
    .order-card { background: var(--card); border: 1px solid var(--border-dim); border-radius: 12px; padding: 1.25rem 1.5rem; margin-bottom: 0.75rem; display: grid; grid-template-columns: 1fr auto; gap: 1rem; align-items: center; transition: border-color 0.2s; }
    .order-card:hover { border-color: var(--border); }
    .order-card.status-pending { border-left: 3px solid #ff9800; }
    .order-card.status-paid { border-left: 3px solid var(--red); }
    .order-card.status-delivered { border-left: 3px solid #4caf50; opacity: 0.6; }
    .order-card.status-cancelled { border-left: 3px solid #555; opacity: 0.4; }
    .order-name { font-weight: 500; font-size: 0.95rem; margin-bottom: 0.2rem; }
    .order-meta { font-size: 0.78rem; color: var(--gray); line-height: 1.7; }
    .order-meta strong { color: var(--light-gray); }
    .status-badge { display: inline-block; padding: 0.25rem 0.7rem; border-radius: 20px; font-size: 0.7rem; font-weight: 500; margin-bottom: 0.75rem; }
    .badge-pending  { background: rgba(255,152,0,0.1);  color: #ff9800; border: 1px solid rgba(255,152,0,0.2); }
    .badge-paid     { background: rgba(204,0,0,0.1);    color: var(--red-bright); border: 1px solid var(--border); }
    .badge-delivered{ background: rgba(0,200,80,0.1);   color: #4caf50; border: 1px solid rgba(0,200,80,0.2); }
    .badge-cancelled{ background: rgba(255,255,255,0.05); color: var(--gray); border: 1px solid var(--border-dim); }
    .order-actions { display: flex; flex-direction: column; gap: 0.5rem; align-items: flex-end; }
    .btn-deliver { background: rgba(0,200,80,0.1); color: #4caf50; border: 1px solid rgba(0,200,80,0.25); border-radius: 7px; padding: 0.5rem 1rem; font-size: 0.8rem; cursor: pointer; transition: all 0.2s; font-family: 'DM Sans', sans-serif; font-weight: 500; white-space: nowrap; }
    .btn-deliver:hover { background: rgba(0,200,80,0.2); }
    .btn-cancel-order { background: none; color: var(--gray); border: 1px solid var(--border-dim); border-radius: 7px; padding: 0.5rem 1rem; font-size: 0.8rem; cursor: pointer; transition: all 0.2s; font-family: 'DM Sans', sans-serif; white-space: nowrap; }
    .btn-cancel-order:hover { color: var(--red-bright); border-color: var(--border); }
    .order-filter-row { display: flex; gap: 0.6rem; margin-bottom: 1.25rem; flex-wrap: wrap; }
    .order-filter { background: transparent; border: 1px solid var(--border-dim); border-radius: 20px; padding: 0.32rem 0.85rem; font-size: 0.78rem; color: var(--gray); cursor: pointer; transition: all 0.2s; font-family: 'DM Sans', sans-serif; }
    .order-filter.active { background: rgba(204,0,0,0.12); border-color: var(--border); color: var(--red-bright); }
    .order-filter:hover { border-color: var(--border); color: var(--white); }
    .menu-tab { background:transparent; border:none; border-bottom:2px solid transparent; padding:0.65rem 1rem; font-family:'DM Sans',sans-serif; font-size:0.85rem; color:var(--gray); cursor:pointer; transition:all 0.2s; margin-bottom:-1px; }
    .menu-tab:hover { color:var(--white); }
    .menu-tab.active { color:var(--red-bright); border-bottom-color:var(--red); }
    .submission-card { background:var(--card); border:1px solid var(--border-dim); border-radius:12px; padding:1.25rem 1.5rem; margin-bottom:0.75rem; display:grid; grid-template-columns:1fr auto; gap:1rem; align-items:start; transition:border-color 0.2s; }
    .submission-card:hover { border-color:var(--border); }
    .submission-card.status-pending  { border-left:3px solid #ff9800; }
    .submission-card.status-approved { border-left:3px solid #4caf50; }
    .submission-card.status-rejected { border-left:3px solid #555; opacity:0.7; }
    .avail-toggle { width:42px; height:24px; border-radius:12px; border:none; background:#333; position:relative; cursor:pointer; transition:background 0.2s; flex-shrink:0; }
    .avail-toggle::after { content:''; position:absolute; width:18px; height:18px; border-radius:50%; background:white; top:3px; left:3px; transition:left 0.2s; }
    .avail-toggle.on { background:var(--red); }
    .avail-toggle.on::after { left:21px; }

    @media (max-width: 900px) { .layout{grid-template-columns:1fr} .sidebar{display:none} .main{padding:1.5rem} .stats-grid{grid-template-columns:1fr 1fr} .schedule-grid{grid-template-columns:1fr 1fr} }
  </style>
</head>
<body>
<div class="layout">
  <aside class="sidebar">
    <div class="sidebar-logo"><img src="../logo.png" alt="The Birdhouse" /></div>
    <div class="user-card">
      <div class="user-name" id="user-display-name">Loading...</div>
      <div class="user-role" id="user-role-badge">Student Staff</div>
    </div>
    <nav>
      <a class="nav-item active" onclick="showSection('overview',this)">üìä Overview</a>
      <a class="nav-item" onclick="showSection('orders',this)">üßæ Active Orders <span id="pending-badge" style="display:none;background:var(--red);color:white;font-size:0.6rem;padding:0.1rem 0.45rem;border-radius:10px;margin-left:auto"></span></a>
      <a class="nav-item" onclick="showSection('schedule',this)">üóìÔ∏è My Schedule</a>
      <a class="nav-item" onclick="showSection('inventory',this)">üì¶ Inventory</a>
      <a class="nav-item" onclick="showSection('sales',this)">üìà Sales Data</a>
      <a class="nav-item" onclick="showSection('menu',this)">‚òï Menu Availability</a>
      <a class="nav-item" onclick="showSection('summary',this)">üìù Weekly Summary</a>
    </nav>
    <button class="signout-btn" onclick="signOut()">‚Üê Sign Out</button>
  </aside>

  <main class="main">
    <!-- Overview -->
    <div id="section-overview">
      <div class="page-eyebrow">Team Hub</div>
      <h1 class="page-title">Hey, <span id="greeting-name">Eagle</span>! üëã</h1>
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-label">Next Shift</div><div class="stat-value" id="stat-next-shift">‚Äî</div><div class="stat-sub" id="stat-next-time">No upcoming shifts</div></div>
        <div class="stat-card"><div class="stat-label">This Week's Orders</div><div class="stat-value" id="stat-week-orders">‚Äî</div><div class="stat-sub">Total delivered</div></div>
        <div class="stat-card"><div class="stat-label">Low Stock Items</div><div class="stat-value" id="stat-low-stock">‚Äî</div><div class="stat-sub">Need restocking</div></div>
      </div>
      <div class="section">
        <div class="section-title">Quick Actions</div>
        <div style="display:flex;gap:1rem;flex-wrap:wrap">
          <button class="btn-primary" onclick="showSection('summary',document.querySelector('[onclick*=summary]'))">üìù Submit Summary</button>
          <button class="btn-secondary" onclick="showSection('inventory',document.querySelector('[onclick*=inventory]'))">üì¶ Update Inventory</button>
        </div>
      </div>
    </div>

    <!-- Schedule -->
    <!-- Active Orders -->
    <div id="section-orders" style="display:none">
      <div class="page-eyebrow">Team Hub</div>
      <h1 class="page-title">Active Orders</h1>
      <div class="order-filter-row">
        <button class="order-filter active" onclick="filterOrders('active',this)">üî¥ Active</button>
        <button class="order-filter" onclick="filterOrders('paid',this)">üí≥ Paid</button>
        <button class="order-filter" onclick="filterOrders('pending',this)">‚è≥ Pending Payment</button>
        <button class="order-filter" onclick="filterOrders('delivered',this)">‚úÖ Delivered</button>
        <button class="order-filter" onclick="filterOrders('all',this)">All</button>
      </div>
      <div id="orders-container"><div style="color:var(--gray);text-align:center;padding:3rem">Loading orders...</div></div>
    </div>

    <div id="section-schedule" style="display:none">
      <div class="page-eyebrow">My Schedule</div>
      <h1 class="page-title" id="schedule-heading">My Schedule</h1>

      <!-- Role card -->
      <div id="role-card" style="display:none;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:1.5rem;margin-bottom:1.75rem">
        <div style="display:flex;align-items:center;gap:1.5rem;flex-wrap:wrap">
          <div style="font-size:3rem" id="role-icon">üè†</div>
          <div style="flex:1">
            <div style="font-size:0.62rem;text-transform:uppercase;letter-spacing:0.15em;color:var(--red);margin-bottom:0.2rem">This Week's Assignment</div>
            <div style="font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:0.04em" id="role-title">‚Äî</div>
            <div style="font-size:0.85rem;color:var(--light-gray);margin-top:0.2rem" id="role-desc">‚Äî</div>
          </div>
          <div id="role-days-badge" style="text-align:right"></div>
        </div>
      </div>

      <!-- Week schedule grid -->
      <div class="schedule-grid" id="schedule-grid"></div>

      <!-- No assignment state -->
      <div id="no-assignment" style="display:none;color:var(--gray);text-align:center;padding:3rem;background:var(--card);border-radius:14px;border:1px solid var(--border-dim)">
        No schedule published for this week yet ‚Äî check back soon!
      </div>
    </div>

    <!-- Inventory -->
    <div id="section-inventory" style="display:none">
      <div class="page-eyebrow">Stock Management</div>
      <h1 class="page-title">Inventory</h1>
      <div class="table-wrap">
        <table>
          <thead><tr><th>Item</th><th>Category</th><th>Stock</th><th>Status</th><th>Update</th></tr></thead>
          <tbody id="inventory-body"><tr><td colspan="5" style="text-align:center;color:var(--gray);padding:2rem">Loading...</td></tr></tbody>
        </table>
      </div>
      <div style="margin-top:1rem"><button class="btn-primary" onclick="addInventoryItem()">+ Add Item</button></div>
    </div>

    <!-- Sales -->
    <div id="section-sales" style="display:none">
      <div class="page-eyebrow">Analytics</div>
      <h1 class="page-title">Sales Data</h1>
      <div class="stats-grid" style="margin-bottom:1.5rem">
        <div class="stat-card"><div class="stat-label">All Time Orders</div><div class="stat-value" id="sales-total">‚Äî</div></div>
        <div class="stat-card"><div class="stat-label">This Week</div><div class="stat-value" id="sales-week">‚Äî</div></div>
        <div class="stat-card"><div class="stat-label">Top Item</div><div class="stat-value" style="font-size:1.3rem" id="sales-top">‚Äî</div></div>
      </div>
      <div class="section">
        <div class="section-title">Orders This Week</div>
        <div class="sales-chart" id="sales-chart"></div>
      </div>
      <div class="section">
        <div class="section-title">Recent Orders</div>
        <div class="table-wrap">
          <table><thead><tr><th>Customer</th><th>Drink</th><th>Room</th><th>Date</th></tr></thead>
          <tbody id="sales-orders-body"><tr><td colspan="4" style="text-align:center;color:var(--gray);padding:2rem">No orders yet.</td></tr></tbody></table>
        </div>
      </div>
    </div>

    <!-- Summary -->
    <!-- Menu Availability -->
    <div id="section-menu" style="display:none">
      <div class="page-eyebrow">Team Hub</div>
      <h1 class="page-title">Menu Availability</h1>
      <p style="color:var(--gray);font-size:0.88rem;margin-bottom:1.5rem">Toggle items on or off for today's service. Changes are live immediately.</p>

      <!-- Tabs -->
      <div style="display:flex;gap:0.5rem;margin-bottom:1.75rem;border-bottom:1px solid var(--border-dim);padding-bottom:0">
        <button class="menu-tab active" id="tab-availability" onclick="switchMenuTab('availability')">‚òï Availability</button>
        <button class="menu-tab" id="tab-suggest" onclick="switchMenuTab('suggest')">‚úèÔ∏è Suggest Changes</button>
        <button class="menu-tab" id="tab-my-submissions" onclick="switchMenuTab('my-submissions')">üìã My Submissions <span id="submission-count" style="display:none;background:var(--red);color:white;font-size:0.6rem;padding:0.1rem 0.4rem;border-radius:10px;margin-left:0.3rem"></span></button>
      </div>

      <!-- Tab: Availability -->
      <div id="menu-tab-availability">
        <div id="menu-hot-section" style="margin-bottom:2rem">
          <div style="display:flex;align-items:center;gap:0.75rem;margin-bottom:0.85rem">
            <span style="font-size:1.2rem">‚òï</span>
            <span style="font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:0.05em">Hot Drinks</span>
            <span style="font-size:0.65rem;padding:0.2rem 0.6rem;border-radius:20px;background:rgba(255,100,0,0.1);color:#ff9944;border:1px solid rgba(255,100,0,0.25)">12 oz</span>
          </div>
          <div class="table-wrap">
            <table><thead><tr><th>Item</th><th>Description</th><th>Available</th><th>Suggest Edit</th></tr></thead>
            <tbody id="menu-hot-body"><tr><td colspan="4" style="text-align:center;color:var(--gray);padding:1.5rem">Loading...</td></tr></tbody></table>
          </div>
        </div>
        <div id="menu-iced-section">
          <div style="display:flex;align-items:center;gap:0.75rem;margin-bottom:0.85rem">
            <span style="font-size:1.2rem">üßä</span>
            <span style="font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:0.05em">Iced Drinks</span>
            <span style="font-size:0.65rem;padding:0.2rem 0.6rem;border-radius:20px;background:rgba(80,160,255,0.1);color:#66aaff;border:1px solid rgba(80,160,255,0.25)">16 oz</span>
          </div>
          <div class="table-wrap">
            <table><thead><tr><th>Item</th><th>Description</th><th>Available</th><th>Suggest Edit</th></tr></thead>
            <tbody id="menu-iced-body"><tr><td colspan="4" style="text-align:center;color:var(--gray);padding:1.5rem">Loading...</td></tr></tbody></table>
          </div>
        </div>
      </div>

      <!-- Tab: Suggest Changes -->
      <div id="menu-tab-suggest" style="display:none">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:2rem;align-items:start">
          <div style="background:var(--card);border:1px solid var(--border-dim);border-radius:14px;padding:1.75rem">
            <div style="font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:0.05em;margin-bottom:1.25rem" id="suggest-form-title">Suggest a New Item</div>
            <input type="hidden" id="suggest-type" value="new" />
            <input type="hidden" id="suggest-target-id" value="" />
            <div class="form-group">
              <label>Drink Name</label>
              <input type="text" id="suggest-name" placeholder="e.g. Brown Sugar Oat Latte" />
            </div>
            <div class="form-group">
              <label>Description</label>
              <input type="text" id="suggest-desc" placeholder="Short description for the menu" />
            </div>
            <div class="form-group">
              <label>Category</label>
              <select id="suggest-category">
                <option>Coffee</option>
                <option>Non-Coffee</option>
                <option>Iced</option>
                <option>Seasonal</option>
              </select>
            </div>
            <div style="display:flex;gap:1.5rem;margin-bottom:1.1rem">
              <label style="display:flex;align-items:center;gap:0.5rem;cursor:pointer;text-transform:none;letter-spacing:0;font-size:0.88rem;color:var(--white)">
                <input type="checkbox" id="suggest-is-hot" checked style="width:auto;padding:0;accent-color:var(--red)" /> ‚òï Available Hot
              </label>
              <label style="display:flex;align-items:center;gap:0.5rem;cursor:pointer;text-transform:none;letter-spacing:0;font-size:0.88rem;color:var(--white)">
                <input type="checkbox" id="suggest-is-iced" style="width:auto;padding:0;accent-color:#4488ff" /> üßä Available Iced
              </label>
            </div>
            <div class="form-group">
              <label>Notes for Admin <span style="color:var(--gray);font-weight:300">(optional)</span></label>
              <input type="text" id="suggest-notes" placeholder="Why you're suggesting this, ingredients needed, etc." />
            </div>
            <button class="btn-primary" onclick="submitSuggestion()">Submit for Approval</button>
            <button class="btn-secondary" id="suggest-cancel-btn" style="display:none;margin-top:0.75rem" onclick="resetSuggestForm()">Cancel Edit</button>
            <div class="msg" id="suggest-msg"></div>
          </div>
          <div style="background:var(--card);border:1px solid var(--border-dim);border-radius:14px;padding:1.75rem">
            <div style="font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:0.05em;margin-bottom:0.75rem">How it works</div>
            <div style="font-size:0.85rem;color:var(--light-gray);line-height:1.8">
              <div style="margin-bottom:0.75rem">‚úèÔ∏è <strong style="color:var(--white)">Suggest new items</strong> or edits to existing ones using this form.</div>
              <div style="margin-bottom:0.75rem">üëÄ <strong style="color:var(--white)">Admin reviews</strong> your submission before anything goes live.</div>
              <div style="margin-bottom:0.75rem">‚úÖ <strong style="color:var(--white)">Approved items</strong> appear on the menu immediately.</div>
              <div>üí¨ <strong style="color:var(--white)">If rejected</strong>, you'll see a note from the admin explaining why.</div>
            </div>
            <div style="margin-top:1.5rem;padding-top:1.25rem;border-top:1px solid var(--border-dim)">
              <div style="font-size:0.72rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--gray);margin-bottom:0.75rem">To suggest an edit to an existing item</div>
              <div style="font-size:0.83rem;color:var(--light-gray);line-height:1.6">Go to the <strong style="color:var(--white)">Availability tab</strong> and click <strong style="color:var(--white)">"Suggest Edit"</strong> next to any item. It will pre-fill this form with the current details.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab: My Submissions -->
      <div id="menu-tab-my-submissions" style="display:none">
        <div id="my-submissions-container"><div style="color:var(--gray);text-align:center;padding:3rem">Loading...</div></div>
      </div>
    </div>

    <div id="section-summary" style="display:none">
      <div class="page-eyebrow">Weekly Summary</div>
      <h1 class="page-title">Submit Your Report</h1>
      <div class="summary-form">
        <div class="form-row">
          <div class="form-group"><label>Week Of</label><input type="date" id="summary-week" /></div>
          <div class="form-group"><label>Hours Worked</label><input type="number" id="summary-hours" placeholder="e.g. 8" min="0" max="40" /></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Orders Fulfilled</label><input type="number" id="summary-orders" placeholder="# of orders" min="0" /></div>
          <div class="form-group"><label>Overall Rating</label>
            <select id="summary-rating">
              <option value="">Select...</option>
              <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excellent</option>
              <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Good</option>
              <option value="3">‚≠ê‚≠ê‚≠ê Average</option>
              <option value="2">‚≠ê‚≠ê Below Average</option>
              <option value="1">‚≠ê Poor</option>
            </select>
          </div>
        </div>
        <div class="form-group"><label>What Went Well?</label><textarea id="summary-good" placeholder="Describe what went smoothly..."></textarea></div>
        <div class="form-group"><label>What Could Be Improved?</label><textarea id="summary-improve" placeholder="Any challenges or suggestions..."></textarea></div>
        <div class="form-group"><label>Inventory Notes</label><textarea id="summary-inventory" placeholder="Items running low? Supply issues?" style="min-height:80px"></textarea></div>
        <div class="form-group"><label>Additional Notes</label><textarea id="summary-notes" placeholder="Anything else to report..." style="min-height:80px"></textarea></div>
        <button class="btn-primary" onclick="submitSummary()">Submit Weekly Summary ‚Üí</button>
        <div class="msg" id="summary-msg"></div>
      </div>
      <div style="margin-top:2rem">
        <div class="section-title">Past Submissions</div>
        <div id="past-summaries"><div style="color:var(--gray);font-size:0.88rem;padding:1.5rem;background:var(--card);border-radius:10px;border:1px solid var(--border-dim)">Loading...</div></div>
      </div>
    </div>
  </main>
</div>

<script>
  const sb = supabase.createClient('https://ljukrhneikqbabcmcpet.supabase.co','sb_publishable_lWdxpZUHbQHiz04wthAC2g_X4ToxDCn');
  const DAYS = ['Monday','Tuesday','Wednesday','Thursday','Friday'];
  let currentUser = null;

  async function init() {
    const {data:{session}} = await sb.auth.getSession();
    if(!session){window.location.href='index.html';return;}
    currentUser = session.user;
    const meta = currentUser.user_metadata;
    if(meta.role!=='student'&&meta.role!=='admin'){await sb.auth.signOut();window.location.href='index.html';return;}
    const firstName = meta.first_name||'Eagle';
    document.getElementById('user-display-name').textContent = firstName+' '+(meta.last_name||'');
    document.getElementById('greeting-name').textContent = firstName;
    document.getElementById('user-role-badge').textContent = meta.role==='admin'?'Admin':'Student Staff';
    loadSchedule(); loadInventory(); loadSales(); loadOrders();
    const today=new Date(); const monday=new Date(today);
    monday.setDate(today.getDate()-(today.getDay()===0?6:today.getDay()-1));
    document.getElementById('summary-week').value=monday.toISOString().split('T')[0];
  }

  // ‚îÄ‚îÄ Orders ‚îÄ‚îÄ
  let allOrders = [], currentOrderFilter = 'active';

  async function loadOrders() {
    const {data, error} = await sb.from('orders').select('*').order('created_at', {ascending: false}).limit(100);
    allOrders = data || [];
    updatePendingBadge();
    renderOrders(currentOrderFilter);
  }

  function updatePendingBadge() {
    const active = allOrders.filter(o => o.status === 'pending' || o.status === 'paid').length;
    const badge = document.getElementById('pending-badge');
    if(active > 0) { badge.textContent = active; badge.style.display = 'inline'; }
    else { badge.style.display = 'none'; }
  }

  function filterOrders(filter, btn) {
    currentOrderFilter = filter;
    document.querySelectorAll('.order-filter').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderOrders(filter);
  }

  function renderOrders(filter) {
    let filtered = allOrders;
    if(filter === 'active')    filtered = allOrders.filter(o => o.status === 'pending' || o.status === 'paid');
    else if(filter === 'paid')     filtered = allOrders.filter(o => o.status === 'paid');
    else if(filter === 'pending')  filtered = allOrders.filter(o => o.status === 'pending');
    else if(filter === 'delivered')filtered = allOrders.filter(o => o.status === 'delivered');

    const container = document.getElementById('orders-container');
    if(!filtered.length) {
      container.innerHTML = `<div style="color:var(--gray);text-align:center;padding:3rem;background:var(--card);border-radius:12px;border:1px solid var(--border-dim)">No ${filter === 'all' ? '' : filter} orders right now.</div>`;
      return;
    }

    container.innerHTML = filtered.map(order => {
      const badgeClass = `badge-${order.status}`;
      const statusLabel = {pending:'‚è≥ Pending Payment', paid:'üí≥ Paid ‚Äî Ready to Make', delivered:'‚úÖ Delivered', cancelled:'‚úï Cancelled'}[order.status] || order.status;
      const time = new Date(order.created_at).toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'});
      const date = new Date(order.created_at).toLocaleDateString('en-US',{month:'short',day:'numeric'});

      const actions = order.status !== 'delivered' && order.status !== 'cancelled' ? `
        <div class="order-actions">
          ${order.status !== 'delivered' ? `<button class="btn-deliver" onclick="markDelivered('${order.id}')">‚úì Mark Delivered</button>` : ''}
          ${order.status !== 'cancelled' ? `<button class="btn-cancel-order" onclick="cancelOrder('${order.id}')">Cancel</button>` : ''}
        </div>` : '';

      return `<div class="order-card status-${order.status}" id="order-card-${order.id}">
        <div>
          <div class="order-name">${order.drink_name} <span style="color:var(--gray);font-weight:400;font-size:0.82rem">‚Äî ${order.customer_name}</span></div>
          <div class="order-meta" style="margin:0.3rem 0 0.6rem">
            <strong>Size:</strong> ${order.size||'‚Äî'} &nbsp;¬∑&nbsp;
            <strong>Milk:</strong> ${order.milk||'‚Äî'} &nbsp;¬∑&nbsp;
            <strong>Syrup:</strong> ${order.syrup||'None'}
            ${order.special_instructions ? `<br><strong>Note:</strong> ${order.special_instructions}` : ''}
          </div>
          <div class="order-meta">
            <strong>Deliver to:</strong> ${order.room||'‚Äî'} &nbsp;¬∑&nbsp;
            <strong>Time:</strong> ${order.delivery_time||'‚Äî'} &nbsp;¬∑&nbsp;
            <strong>Day:</strong> ${order.delivery_day||'‚Äî'}
          </div>
          <div style="margin-top:0.75rem">
            <span class="status-badge ${badgeClass}">${statusLabel}</span>
            <span style="font-size:0.72rem;color:var(--gray);margin-left:0.5rem">Ordered ${date} at ${time}</span>
          </div>
        </div>
        ${actions}
      </div>`;
    }).join('');
  }

  async function markDelivered(id) {
    await sb.from('orders').update({status:'delivered'}).eq('id',id);
    const order = allOrders.find(o=>o.id===id);
    if(order) order.status = 'delivered';
    updatePendingBadge();
    renderOrders(currentOrderFilter);
  }

  async function cancelOrder(id) {
    if(!confirm('Cancel this order?')) return;
    await sb.from('orders').update({status:'cancelled'}).eq('id',id);
    const order = allOrders.find(o=>o.id===id);
    if(order) order.status = 'cancelled';
    updatePendingBadge();
    renderOrders(currentOrderFilter);
  }

  const ROLE_META = {
    birdhouse:{icon:'üè†', label:'The Birdhouse', desc:'In-store service ¬∑ All week', days:['Monday','Tuesday','Wednesday','Thursday','Friday'], color:'#cc0000'},
    mathews:  {icon:'üè´', label:'Mathews',        desc:'Second location ¬∑ Mon / Wed / Fri', days:['Monday','Wednesday','Friday'], color:'#0066cc'},
    menu:     {icon:'üìã', label:'Menu Planning',  desc:'Prepping next week\'s menu ¬∑ In class all week', days:[], color:'#cc8800'},
    inclass:  {icon:'üìö', label:'In Class',       desc:'Classroom activities all week', days:[], color:'#6600cc'},
  };
  const POS_LABELS = {cashier:'Cashier',barista:'Barista',stocker:'Stocker',custodian:'Custodian'};

  async function loadSchedule() {
    const today = new Date();
    const day = today.getDay();
    const diff = day===0?-6:1-day;
    const monday = new Date(today); monday.setDate(today.getDate()+diff); monday.setHours(0,0,0,0);
    const ws = monday.toISOString().split('T')[0];

    // Get student's team
    const {data:studentData} = await sb.from('students').select('team_id,period,teams(name,period,color)').eq('id',currentUser.id).single();
    const teamId = studentData?.team_id;
    const teamName = studentData?.teams?.name;
    const teamColor = studentData?.teams?.color||'#cc0000';
    const teamPeriod = studentData?.teams?.period;

    // Update heading
    const heading = document.getElementById('schedule-heading');
    if(heading && teamName) heading.innerHTML = `My Schedule <span style="font-family:'DM Sans',sans-serif;font-size:1.1rem;font-weight:400;color:${teamColor};margin-left:0.5rem">${teamName}</span> <span style="font-size:0.85rem;color:${teamPeriod==='1st Hour'?'#ff9944':'#66aaff'};font-family:'DM Sans',sans-serif">${teamPeriod||''}</span>`;

    if(!teamId){document.getElementById('no-assignment').style.display='block';return;}

    // Get weekly assignment
    const {data:assignment} = await sb.from('weekly_assignments').select('*').eq('team_id',teamId).eq('week_start',ws).single();

    if(!assignment){
      document.getElementById('no-assignment').style.display='block';
      document.getElementById('role-card').style.display='none';
      document.getElementById('schedule-grid').innerHTML='';
      return;
    }

    // Show role card
    const role = ROLE_META[assignment.role]||ROLE_META.inclass;
    document.getElementById('role-card').style.display='block';
    document.getElementById('no-assignment').style.display='none';
    document.getElementById('role-icon').textContent=role.icon;
    document.getElementById('role-title').textContent=role.label;
    document.getElementById('role-title').style.color=role.color;
    document.getElementById('role-desc').textContent=role.desc;

    const daysHtml = role.days.length
      ? role.days.map(d=>`<div style="font-size:0.72rem;padding:0.2rem 0.6rem;background:rgba(255,255,255,0.05);border-radius:4px;margin-bottom:0.25rem;color:var(--light-gray)">${d}</div>`).join('')
      : `<div style="font-size:0.72rem;color:var(--gray)">In Class all week</div>`;
    document.getElementById('role-days-badge').innerHTML=daysHtml;

    // Get daily positions for this student this week
    const weekDates = [0,1,2,3,4].map(i=>{const d=new Date(monday);d.setDate(monday.getDate()+i);return d;});
    const {data:positions} = await sb.from('daily_positions').select('*')
      .eq('student_id',currentUser.id)
      .in('shift_date',weekDates.map(d=>d.toISOString().split('T')[0]));
    const posMap = {};
    (positions||[]).forEach(p=>posMap[p.shift_date]=p.position);

    const DAYS = ['Monday','Tuesday','Wednesday','Thursday','Friday'];
    const grid = document.getElementById('schedule-grid');

    // For Mathews: Tue/Thu are In Class
    const isWorking = (roleKey, dayIndex) => {
      if(roleKey==='birdhouse') return true;
      if(roleKey==='mathews') return [0,2,4].includes(dayIndex); // Mon/Wed/Fri
      return false;
    };
    const hasPositions = assignment.role==='birdhouse'||assignment.role==='mathews';
    let nextShift=null;

    grid.innerHTML = DAYS.map((dayName,i)=>{
      const date = weekDates[i];
      const dateStr = date.toISOString().split('T')[0];
      const isToday = date.toDateString()===today.toDateString();
      const working = hasPositions && isWorking(assignment.role, i);
      const inClassDay = assignment.role==='mathews' && !working;
      const position = posMap[dateStr];

      if(!hasPositions || inClassDay) {
        if(dateStr >= today.toISOString().split('T')[0] && !nextShift && (assignment.role==='birdhouse'||assignment.role==='mathews'&&working)) nextShift={day:dayName};
        return `<div class="schedule-day ${isToday?'today':''}">
          <div class="day-name">${dayName.slice(0,3)}</div>
          <div class="day-date">${date.getMonth()+1}/${date.getDate()}</div>
          <div class="day-off">${inClassDay?'In Class':'No Shift'}</div>
        </div>`;
      }

      if(dateStr >= today.toISOString().split('T')[0] && !nextShift) nextShift={day:dayName,pos:position};
      return `<div class="schedule-day ${isToday?'today':''}">
        <div class="day-name">${dayName.slice(0,3)}</div>
        <div class="day-date">${date.getMonth()+1}/${date.getDate()}</div>
        <div class="day-shift" style="color:${role.color}">Working</div>
        ${position?`<div class="day-time">${POS_LABELS[position]||position}</div>`:'<div class="day-time" style="color:var(--gray)">TBD</div>'}
      </div>`;
    }).join('');

    if(nextShift){
      document.getElementById('stat-next-shift').textContent=nextShift.day;
      document.getElementById('stat-next-time').textContent=nextShift.pos?POS_LABELS[nextShift.pos]:'Working';
    }
  }

  async function loadInventory() {
    const {data} = await sb.from('inventory').select('*').order('name');
    const body=document.getElementById('inventory-body');
    if(!data||!data.length){body.innerHTML='<tr><td colspan="5" style="text-align:center;color:var(--gray);padding:2rem">No items yet. Add your first!</td></tr>';document.getElementById('stat-low-stock').textContent='0';return;}
    const low=data.filter(i=>i.quantity<=i.low_threshold).length;
    document.getElementById('stat-low-stock').textContent=low;
    body.innerHTML=data.map(item=>{
      const s=item.quantity===0?'out':item.quantity<=item.low_threshold?'low':'ok';
      const labels={ok:'In Stock',low:'Low',out:'Out of Stock'};
      return `<tr><td><strong>${item.name}</strong></td><td style="color:var(--gray)">${item.category||'‚Äî'}</td><td>${item.quantity} ${item.unit||''}</td>
        <td><span class="stock-badge stock-${s}">${labels[s]}</span></td>
        <td style="display:flex;gap:0.5rem;align-items:center"><input class="qty-input" type="number" id="qty-${item.id}" value="${item.quantity}" min="0"/><button class="update-btn" onclick="updateInventory('${item.id}')">Save</button></td></tr>`;
    }).join('');
  }

  async function updateInventory(id) {
    const qty=parseInt(document.getElementById('qty-'+id).value);
    await sb.from('inventory').update({quantity:qty,updated_at:new Date().toISOString()}).eq('id',id);
    loadInventory();
  }

  async function addInventoryItem() {
    const name=prompt('Item name:'); if(!name)return;
    const category=prompt('Category:')||'General';
    const qty=parseInt(prompt('Starting quantity:')||'0');
    const unit=prompt('Unit (e.g. bottles, oz):')||'units';
    const threshold=parseInt(prompt('Alert when quantity falls below:')||'5');
    await sb.from('inventory').insert({name,category,quantity:qty,unit,low_threshold:threshold});
    loadInventory();
  }

  async function loadSales() {
    const {data:orders} = await sb.from('orders').select('*').order('created_at',{ascending:false});
    if(!orders||!orders.length){['sales-total','sales-week','stat-week-orders'].forEach(id=>document.getElementById(id).textContent='0');return;}
    const weekAgo=new Date(); weekAgo.setDate(weekAgo.getDate()-7);
    const thisWeek=orders.filter(o=>new Date(o.created_at)>weekAgo);
    document.getElementById('sales-total').textContent=orders.length;
    document.getElementById('sales-week').textContent=thisWeek.length;
    document.getElementById('stat-week-orders').textContent=thisWeek.length;
    const counts={}; orders.forEach(o=>{counts[o.drink_name]=(counts[o.drink_name]||0)+1;});
    const top=Object.entries(counts).sort((a,b)=>b[1]-a[1])[0];
    document.getElementById('sales-top').textContent=top?top[0]:'‚Äî';
    const chart=document.getElementById('sales-chart');
    const today=new Date(); const ws=new Date(today); ws.setDate(today.getDate()-(today.getDay()===0?6:today.getDay()-1));
    const dayCounts=DAYS.map((_,i)=>{const d=new Date(ws);d.setDate(ws.getDate()+i);return orders.filter(o=>new Date(o.created_at).toDateString()===d.toDateString()).length;});
    const maxVal=Math.max(...dayCounts,1);
    chart.innerHTML=DAYS.map((day,i)=>`<div class="bar-wrap"><div class="bar" style="height:${Math.round(dayCounts[i]/maxVal*100)}%" title="${dayCounts[i]} orders"></div><div class="bar-label">${day.slice(0,3)}<br>${dayCounts[i]}</div></div>`).join('');
    document.getElementById('sales-orders-body').innerHTML=orders.slice(0,20).map(o=>`<tr><td>${o.customer_name||'Customer'}</td><td>${o.drink_name}</td><td>${o.room||'‚Äî'}</td><td style="color:var(--gray)">${new Date(o.created_at).toLocaleDateString()}</td></tr>`).join('');
  }

  async function submitSummary() {
    const week=document.getElementById('summary-week').value;
    const hours=document.getElementById('summary-hours').value;
    const rating=document.getElementById('summary-rating').value;
    const btn=event.target;
    if(!week||!hours||!rating){const m=document.getElementById('summary-msg');m.textContent='Please fill in Week, Hours, and Rating.';m.className='msg error';return;}
    btn.disabled=true; btn.textContent='Submitting...';
    const meta=currentUser.user_metadata;
    const {error} = await sb.from('weekly_summaries').insert({
      student_id:currentUser.id, student_name:(meta.first_name||'')+' '+(meta.last_name||''),
      week_of:week, hours_worked:parseFloat(hours), orders_fulfilled:parseInt(document.getElementById('summary-orders').value)||0,
      rating:parseInt(rating), went_well:document.getElementById('summary-good').value,
      improvements:document.getElementById('summary-improve').value,
      inventory_notes:document.getElementById('summary-inventory').value,
      notes:document.getElementById('summary-notes').value
    });
    const m=document.getElementById('summary-msg');
    if(error){m.textContent='Error: '+error.message;m.className='msg error';}
    else{m.textContent='‚úì Summary submitted successfully!';m.className='msg success';loadPastSummaries();}
    btn.disabled=false; btn.textContent='Submit Weekly Summary ‚Üí';
  }

  // ‚îÄ‚îÄ Menu tabs ‚îÄ‚îÄ
  function switchMenuTab(tab) {
    ['availability','suggest','my-submissions'].forEach(t=>{
      document.getElementById('menu-tab-'+t).style.display = t===tab?'block':'none';
      document.getElementById('tab-'+t)?.classList.toggle('active', t===tab);
    });
    if(tab==='my-submissions') loadMySubmissions();
  }

  async function loadMenuAvailability() {
    const {data} = await sb.from('menu_items').select('*').order('sort_order');
    if(!data) return;
    const hotItems  = data.filter(i => i.is_hot !== false && i.is_iced !== true);
    const icedItems = data.filter(i => i.is_iced === true);
    const renderRows = (items, tbodyId) => {
      const tbody = document.getElementById(tbodyId);
      if(!items.length){tbody.innerHTML=`<tr><td colspan="4" style="text-align:center;color:var(--gray);padding:1.5rem">No items in this category.</td></tr>`;return;}
      tbody.innerHTML = items.map(item=>`
        <tr>
          <td><strong>${item.name}</strong></td>
          <td style="color:var(--gray);font-size:0.82rem">${item.description||'‚Äî'}</td>
          <td>
            <button class="avail-toggle ${item.available?'on':''}" id="menu-toggle-${item.id}"
              onclick="toggleMenuAvail('${item.id}', ${item.available})">
            </button>
            <span style="font-size:0.75rem;color:var(--gray);margin-left:0.6rem">${item.available?'Available':'Unavailable'}</span>
          </td>
          <td>
            <button class="icon-btn" onclick='prefillEditForm(${JSON.stringify(item).replace(/'/g,"&#39;")})'>‚úèÔ∏è Suggest Edit</button>
          </td>
        </tr>`).join('');
    };
    renderRows(hotItems, 'menu-hot-body');
    renderRows(icedItems, 'menu-iced-body');
    // Load pending submission count
    loadSubmissionBadge();
  }

  async function loadSubmissionBadge() {
    const {data:{user}} = await sb.auth.getUser();
    const {count} = await sb.from('menu_submissions').select('*',{count:'exact',head:true}).eq('student_id',user.id).eq('status','pending');
    const badge = document.getElementById('submission-count');
    if(count>0){badge.textContent=count;badge.style.display='inline';}
    else{badge.style.display='none';}
  }

  async function toggleMenuAvail(id, current) {
    const newVal = !current;
    await sb.from('menu_items').update({available: newVal}).eq('id', id);
    const btn = document.getElementById('menu-toggle-'+id);
    if(btn){
      btn.classList.toggle('on', newVal);
      const label = btn.nextElementSibling;
      if(label) label.textContent = newVal?'Available':'Unavailable';
      btn.setAttribute('onclick',`toggleMenuAvail('${id}', ${newVal})`);
    }
  }

  function prefillEditForm(item) {
    document.getElementById('suggest-type').value = 'edit';
    document.getElementById('suggest-target-id').value = item.id;
    document.getElementById('suggest-form-title').textContent = `Suggest Edit: ${item.name}`;
    document.getElementById('suggest-name').value = item.name||'';
    document.getElementById('suggest-desc').value = item.description||'';
    document.getElementById('suggest-category').value = item.category||'Coffee';
    document.getElementById('suggest-is-hot').checked = item.is_hot !== false;
    document.getElementById('suggest-is-iced').checked = item.is_iced === true;
    document.getElementById('suggest-notes').value = '';
    document.getElementById('suggest-cancel-btn').style.display = 'block';
    document.getElementById('suggest-msg').style.display = 'none';
    switchMenuTab('suggest');
  }

  function resetSuggestForm() {
    document.getElementById('suggest-type').value = 'new';
    document.getElementById('suggest-target-id').value = '';
    document.getElementById('suggest-form-title').textContent = 'Suggest a New Item';
    document.getElementById('suggest-name').value = '';
    document.getElementById('suggest-desc').value = '';
    document.getElementById('suggest-category').value = 'Coffee';
    document.getElementById('suggest-is-hot').checked = true;
    document.getElementById('suggest-is-iced').checked = false;
    document.getElementById('suggest-notes').value = '';
    document.getElementById('suggest-cancel-btn').style.display = 'none';
    document.getElementById('suggest-msg').style.display = 'none';
  }

  async function submitSuggestion() {
    const {data:{user}} = await sb.auth.getUser();
    const meta = user.user_metadata;
    const name = document.getElementById('suggest-name').value.trim();
    const m = document.getElementById('suggest-msg');
    if(!name){m.textContent='Please enter a drink name.';m.className='msg error';return;}
    const payload = {
      student_id: user.id,
      student_name: (meta.first_name||'')+ ' '+(meta.last_name||''),
      type: document.getElementById('suggest-type').value,
      target_item_id: document.getElementById('suggest-target-id').value||null,
      proposed_name: name,
      proposed_description: document.getElementById('suggest-desc').value,
      proposed_category: document.getElementById('suggest-category').value,
      proposed_is_hot: document.getElementById('suggest-is-hot').checked,
      proposed_is_iced: document.getElementById('suggest-is-iced').checked,
      notes: document.getElementById('suggest-notes').value,
      status: 'pending'
    };
    const {error} = await sb.from('menu_submissions').insert(payload);
    if(error){m.textContent='Error: '+error.message;m.className='msg error';}
    else{
      m.textContent='‚úì Submitted! Admin will review it shortly.';m.className='msg success';
      resetSuggestForm();
      loadSubmissionBadge();
    }
  }

  async function loadMySubmissions() {
    const {data:{user}} = await sb.auth.getUser();
    const {data} = await sb.from('menu_submissions').select('*').eq('student_id',user.id).order('created_at',{ascending:false});
    const container = document.getElementById('my-submissions-container');
    if(!data?.length){container.innerHTML='<div style="color:var(--gray);text-align:center;padding:3rem;background:var(--card);border-radius:12px;border:1px solid var(--border-dim)">No submissions yet. Use the Suggest Changes tab to propose a new item or edit.</div>';return;}
    const statusLabel = {pending:'‚è≥ Pending Review', approved:'‚úÖ Approved', rejected:'‚úï Rejected'};
    const statusColor = {pending:'#ff9800', approved:'#4caf50', rejected:'#666'};
    container.innerHTML = data.map(s=>`
      <div class="submission-card status-${s.status}">
        <div>
          <div style="font-weight:500;font-size:0.95rem;margin-bottom:0.2rem">${s.proposed_name} <span style="font-size:0.75rem;color:var(--gray);font-weight:400">${s.type==='edit'?'(edit suggestion)':'(new item)'}</span></div>
          <div style="font-size:0.8rem;color:var(--gray);margin-bottom:0.6rem">${s.proposed_description||''} ¬∑ ${s.proposed_category||''} ${s.proposed_is_hot?'‚òï':''}${s.proposed_is_iced?'üßä':''}</div>
          ${s.notes?`<div style="font-size:0.8rem;color:var(--light-gray)">Your note: ${s.notes}</div>`:''}
          ${s.admin_note?`<div style="font-size:0.8rem;color:${statusColor[s.status]};margin-top:0.5rem;background:rgba(255,255,255,0.03);border-radius:6px;padding:0.5rem 0.75rem">Admin: ${s.admin_note}</div>`:''}
        </div>
        <div style="text-align:right">
          <div style="font-size:0.78rem;font-weight:500;color:${statusColor[s.status]}">${statusLabel[s.status]}</div>
          <div style="font-size:0.72rem;color:var(--gray);margin-top:0.3rem">${new Date(s.created_at).toLocaleDateString('en-US',{month:'short',day:'numeric'})}</div>
        </div>
      </div>`).join('');
  }
    const {data} = await sb.from('weekly_summaries').select('*').eq('student_id',currentUser.id).order('week_of',{ascending:false}).limit(5);
    const container=document.getElementById('past-summaries');
    if(!data||!data.length){container.innerHTML='<div style="color:var(--gray);font-size:0.88rem;padding:1.5rem;background:var(--card);border-radius:10px;border:1px solid var(--border-dim)">No past summaries yet.</div>';return;}
    container.innerHTML=data.map(s=>`<div class="past-summary-item"><div><div style="font-weight:500;font-size:0.92rem">Week of ${s.week_of}</div><div style="font-size:0.76rem;color:var(--gray);margin-top:0.2rem">${s.hours_worked}h worked ¬∑ ${s.orders_fulfilled} orders ¬∑ ${'‚≠ê'.repeat(s.rating)}</div></div><div style="font-size:0.75rem;color:var(--gray)">${new Date(s.created_at).toLocaleDateString()}</div></div>`).join('');
  }

  function showSection(name,el) {
    document.querySelectorAll('[id^="section-"]').forEach(s=>s.style.display='none');
    document.getElementById('section-'+name).style.display='block';
    document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
    if(el)el.classList.add('active');
    if(name==='summary')loadPastSummaries();
    if(name==='menu')loadMenuAvailability();
    if(name==='orders')loadOrders();
  }

  async function signOut() { await sb.auth.signOut(); window.location.href='index.html'; }
  init();
</script>
</body>
</html>
